(function(g){var window=this;'use strict';var MkM=function(S){var b=new g.HL("und",new g.Fl("Default","und",!0));b.captionTracks=S.captionTracks;return b},r$6=function(S){return new g.kH(function(b,C){var z=S.length,U=[];
if(z)for(var a=function(x,E){z--;U[x]=E;z==0&&b(U)},J=function(x){C(x)},H,B=0;B<S.length;B++)H=S[B],g.h2R(H,g.zK(a,B),J);
else b(U)})},ve=function(S){this.J=S},Ki=function(){ve.apply(this,arguments)},ZbX=function(){Ki.apply(this,arguments)},hOx=function(){Ki.apply(this,arguments)},IYm=function(){Ki.apply(this,arguments)},wDU=function(){Ki.apply(this,arguments)},LWL=function(){Ki.apply(this,arguments)},qy2=function(){Ki.apply(this,arguments)},ST8=function(){ve.apply(this,arguments)},bak=function(){Ki.apply(this,arguments)},CHX=function(){Ki.apply(this,arguments)},ia8=function(){Ki.apply(this,arguments)},zQk=function(){Ki.apply(this,
arguments)},$Jm=function(){Ki.apply(this,arguments)},UJU=function(){Ki.apply(this,arguments)},a0l=function(){Ki.apply(this,arguments)},oMX=function(){Ki.apply(this,arguments)},J_L=function(){Ki.apply(this,arguments)},y_8=function(){Ki.apply(this,arguments)},Ha6=function(){Ki.apply(this,arguments)},BTx=function(){Ki.apply(this,arguments)},sPL=function(){ve.apply(this,arguments)},xJK=function(){Ki.apply(this,arguments)},EMM=function(){Ki.apply(this,arguments)},dJO=function(){Ki.apply(this,arguments)},
pU2=function(){Ki.apply(this,arguments)},Fz8=function(){Ki.apply(this,arguments)},TT8=function(){Ki.apply(this,arguments)},V8k=function(){Ki.apply(this,arguments)},PH2=function(){Ki.apply(this,arguments)},t8X=function(){Ki.apply(this,arguments)},kH8=function(){ve.apply(this,arguments)},ukX=function(){ve.apply(this,arguments)},eQ2=function(){ve.apply(this,arguments)},GHx=function(){Ki.apply(this,arguments)},f0M=function(){Ki.apply(this,arguments)},mJK=function(){Ki.apply(this,arguments)},RQO=function(){Ki.apply(this,
arguments)},WzK=function(){Ki.apply(this,arguments)},l0X=function(){Ki.apply(this,arguments)},jP5=function(){Ki.apply(this,arguments)},XUk=function(){Ki.apply(this,arguments)},Oax=function(){Ki.apply(this,arguments)},A_8=function(){Ki.apply(this,arguments)},vMk=function(){Ki.apply(this,arguments)},Kz5=function(){Ki.apply(this,arguments)},QPk=function(){Ki.apply(this,arguments)},c_c=function(){Ki.apply(this,arguments)},DJl=function(){Ki.apply(this,arguments)},NTx=function(){Ki.apply(this,arguments)},
nMl=function(){Ki.apply(this,arguments)},gM6=function(){Ki.apply(this,arguments)},YTO=function(){Ki.apply(this,arguments)},M8l=function(){Ki.apply(this,arguments)},r_2=function(){Ki.apply(this,arguments)},Za8=function(){Ki.apply(this,arguments)},hQ6=function(){Ki.apply(this,arguments)},I0O=function(){Ki.apply(this,arguments)},wUM=function(){Ki.apply(this,arguments)},LzU=function(){Ki.apply(this,arguments)},qTk=function(){ve.apply(this,arguments)},SA1=function(){Ki.apply(this,arguments)},bUO=function(){Ki.apply(this,
arguments)},Com=function(){Ki.apply(this,arguments)},iUx=function(){Ki.apply(this,arguments)},zgL=function(){Ki.apply(this,arguments)},$IM=function(){Ki.apply(this,arguments)},UIc=function(){Ki.apply(this,arguments)},az5=function(){Ki.apply(this,arguments)},oHc=function(){Ki.apply(this,arguments)},JBx=function(){Ki.apply(this,arguments)},yB2=function(){Ki.apply(this,arguments)},HUm=function(){Ki.apply(this,arguments)},B$6=function(){Ki.apply(this,arguments)},sfL=function(){Ki.apply(this,arguments)},
xIc=function(){Ki.apply(this,arguments)},EHX=function(){Ki.apply(this,arguments)},dI6=function(){Ki.apply(this,arguments)},plU=function(){Ki.apply(this,arguments)},FY5=function(){Ki.apply(this,arguments)},T$K=function(){Ki.apply(this,arguments)},VCL=function(){Ki.apply(this,arguments)},PoX=function(){Ki.apply(this,arguments)},tCX=function(){Ki.apply(this,arguments)},ku6=function(){Ki.apply(this,arguments)},uY6=function(){Ki.apply(this,arguments)},eg1=function(){Ki.apply(this,arguments)},Guc=function(){Ki.apply(this,
arguments)},fz5=function(){Ki.apply(this,arguments)},mIK=function(){Ki.apply(this,arguments)},RgO=function(){Ki.apply(this,arguments)},WYX=function(){Ki.apply(this,arguments)},lzK=function(){Ki.apply(this,arguments)},jfl=function(S){S=S.key||S.id;
if(!S)throw Error("Entity key is missing");return S},Xll=function(){if(Q5)return Q5();
var S={};Q5=g.bs("PersistentEntityStoreDb",{J2:(S.EntityStore={a5:1},S.EntityAssociationStore={a5:2},S),shared:!1,upgrade:function(b,C){C(1)&&g.vo(g.Wo(b,"EntityStore",{keyPath:"key"}),"entityType","entityType");C(2)&&(b=g.Wo(b,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.vo(b,"byParentEntityKey","parentEntityKey"),g.vo(b,"byChildEntityKey","childEntityKey"))},
version:3});return Q5()},OUX=function(S){return g.Yc(Xll(),S)},ABK=function(S){return g.Yc((0,g.ktO)(),S)},ce=function(S){this.token=S},D4=function(S,b){b=b===void 0?{}:b;
g.ZL.call(this,g.uSx[S],Object.assign({},{name:"PESEncoderError",type:S},b));this.type=S;this.level="WARNING";Object.setPrototypeOf(this,D4.prototype)},vHK=function(S){return new D4("WRONG_DATA_TYPE",{Pi:S})},KY6=function(S){return S instanceof Error?new D4("UNKNOWN_ENCODE_ERROR",{originalMessage:S.message}):new D4("UNKNOWN_ENCODE_ERROR")},Qf1=function(S){return S instanceof Error?new D4("UNKNOWN_DECODE_ERROR",{originalMessage:S.message}):new D4("UNKNOWN_DECODE_ERROR")},cBU=function(S,b){S=S instanceof
D4?S:b(S);
g.AQ(S);throw S;},DI1=function(){},N$l=function(S,b,C){try{return S.Y(b,C)}catch(z){cBU(z,KY6)}},nH6=function(S){S=(new TextEncoder).encode(S).subarray(0,16);
var b=new Uint8Array(16);b.set(S);return b},NV=function(S){this.J=S},YA1=function(S){var b=gHx[S];
if(b)return b;g.vq(new g.ZL("Entity model not found.",{entityType:S}))},MCK=function(S,b){this.J=S;
this.K=b;this.Y={}},ZU8=function(S,b){a:{S=rB8(S.K,b.version);
try{var C=S.K(b.data,b.key);break a}catch(z){cBU(z,Qf1)}C=void 0}return C},ni=function(S,b,C){return S.J.objectStore("EntityStore").get(b).then(function(z){if(z){if(C&&z.entityType!==C)throw Error("Incorrect entity type");
return ZU8(S,z)}})},gm=function(S,b,C){return C?(C=C.map(function(z){return ni(S,z,b)}),g.u4.all(C)):S.J.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(b)).then(function(z){return z.map(function(U){return ZU8(S,U)})})},MV=function(S,b,C){var z=jfl(b),U=rB8(S.K,1),a=Object.assign({},b);
return S.J.objectStore("EntityStore").get(z).then(function(J){if(J){if(J.entityType!==C)throw Error("Incorrect entity type");a.entityMetadata||(J=ZU8(S,J),a.entityMetadata=J.entityMetadata)}}).then(function(){var J={key:z,
entityType:C,data:N$l(U,a,z),version:1};return g.u4.all([g.XC(S.J.objectStore("EntityStore"),J),hgk(S,a,C)])}).then(function(){YR(S,z,C);
return z})},IzK=function(S,b,C){b=b.map(function(z){return MV(S,z,C)});
return g.u4.all(b)},rm=function(S,b,C){if(C==null?0:C.K$){var z=new Set;
return wlM(S,b,z).then(function(){for(var a=[],J=g.t(z),H=J.next();!H.done;H=J.next())a.push(rm(S,H.value));return g.u4.all(a).then(function(){})})}var U=g.Lh(b).entityType;
return g.u4.all([S.J.objectStore("EntityStore").delete(b),LYL(S,b)]).then(function(){YR(S,b,U)})},qAx=function(S,b){return g.DZ(S.J.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(b)},function(C){return g.u4.all([C.delete(),
LYL(S,C.cursor.primaryKey)]).then(function(){YR(S,C.cursor.primaryKey,b);return g.Qc(C)})})},S9K=function(S,b,C,z){var U=rB8(S.K,1);
return ni(S,b,z).then(function(a){if(a){a=g.ph(a,C);var J={key:b,entityType:z,data:N$l(U,a,b),version:1};return g.u4.all([g.XC(S.J.objectStore("EntityStore"),J),hgk(S,a,z)])}}).then(function(){YR(S,b,z);
return b})},YR=function(S,b,C){var z=S.Y[C];
z||(z=new Set,S.Y[C]=z);z.add(b)},btk=function(S,b,C){var z=jfl(b);
C=YA1(C);if(!C)return g.u4.resolve([]);C=new C(b);S=S.J.objectStore("EntityAssociationStore");b=[];C=g.t(C.K());for(var U=C.next();!U.done;U=C.next())b.push(g.XC(S,{parentEntityKey:z,childEntityKey:U.value}));return g.u4.all(b).then(function(a){return a.map(function(J){return J[1]})})},LYL=function(S,b){return S.J.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(b))},hgk=function(S,b,C){var z=jfl(b);
return LYL(S,z).then(function(){return btk(S,b,C)})},wlM=function(S,b,C){if(C.has(b))return g.u4.resolve(void 0);
C.add(b);return Czc(S,b).then(function(z){return S.J.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(b)).then(function(){return z})}).then(function(z){var U=g.u4.resolve(void 0);
z=g.t(z);for(var a=z.next(),J={};!a.done;J={Ir:void 0},a=z.next())J.Ir=a.value,U=U.then(function(H){return function(){return wlM(S,H.Ir,C)}}(J));
return U}).then(function(){})},Czc=function(S,b){var C=S.J.objectStore("EntityAssociationStore");
return C.index("byParentEntityKey").getAll(IDBKeyRange.only(b)).then(function(z){var U=[];z=g.t(z);for(var a=z.next();!a.done;a=z.next())a=a.value,U.push(C.index("byChildEntityKey").getAll(a.childEntityKey));return g.u4.all(U)}).then(function(z){var U=[];
z=g.t(z);for(var a=z.next();!a.done;a=z.next())a=a.value,a.length===1&&U.push(a[0].childEntityKey);return U})},Z4=function(){},it6=function(){this.J={};
this.J[0]=new Z4;if(!g.P_("aes_pes_encoder_killswitch")){var S=this.J;try{var b=g.hq();var C=nH6(b);var z=new NV(new g.eN(C),new g.uk(C))}catch(U){throw S=U instanceof Error?new D4("KEY_CREATION_FAILED",{originalMessage:U.message}):new D4("KEY_CREATION_FAILED"),g.AQ(S),S;}S[1]=z}},rB8=function(S,b){b=b===void 0?0:b;
S=S.J[b];if(!S)throw b=new D4("INVALID_ENCODER_VERSION",{Pi:b}),g.AQ(b),b;return S},hR=function(S,b){g.D.call(this);
this.token=S;this.J=b;this.observers=[];S=new g.Ym.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.hq());S.onmessage=this.K.bind(this);this.channel=S},Ih=function(S,b,C){var z,U,a,J;
return g.O(function(H){if(H.J==1)return g.l(H,OUX(S.token),2);if(H.J!=3)return z=H.K,g.l(H,g.ji(z,["EntityStore","EntityAssociationStore"],b,function(B){U=new MCK(B,S.J);return C(U)}),3);
a=H.K;U&&(J=U.Y,Object.keys(J).length>0&&(S.channel.postMessage(J),zT2(S,J)));return H.return(a)})},wm=function(S,b,C){return Ih(S,{mode:"readwrite",
He:!0},function(z){return MV(z,b,C)})},$15=function(S,b){return Ih(S,{mode:"readwrite",
He:!0},function(C){return IzK(C,b,"offlineOrchestrationActionWrapperEntity")})},U1U=function(S,b){return Ih(S,{mode:"readwrite",
He:!0},function(C){return rm(C,b)})},aVM=function(S){return Ih(S,{mode:"readwrite",
He:!0},function(b){return qAx(b,"videoPlaybackPositionEntity")})},Li=function(S,b,C){return Ih(S,{mode:"readonly",
He:!0},function(z){return ni(z,b,C)})},qV=function(S,b,C){return Ih(S,{mode:"readonly",
He:!0},function(z){return gm(z,b,C)})},zT2=function(S,b){S=g.t(S.observers);
for(var C=S.next();!C.done;C=S.next())C=C.value,C(b)},opO=function(){var S,b,C;
return g.O(function(z){if(z.J==1)return g.u2(z,2),g.l(z,g.q6(),4);if(z.J!=2){S=z.K;if(!S||!g.IW()||typeof g.Ym.BroadcastChannel==="undefined")return z.return();b=new it6;return z.return(new hR(S,b))}C=g.fN(z);C instanceof Error&&g.AQ(C);return z.return()})},SF=function(){Jt2||(Jt2=opO());
return Jt2},ytX=function(S){var b;
S=(b=S.options)==null?void 0:b.persistenceOption;return S==="ENTITY_PERSISTENCE_OPTION_PERSIST"||S==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},HtO=function(S){var b;
return g.O(function(C){return C.J==1?g.l(C,SF(),2):(b=C.K)?g.l(C,Ih(b,"readwrite",function(z){for(var U={},a=g.t(S),J=a.next(),H={};!J.done;H={f8:void 0,bE:void 0},J=a.next())H.f8=J.value,H.f8.entityKey&&ytX(H.f8)&&(H.bE=g.NU(H.f8.payload),J=void 0,H.f8.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(J=function(B){return function(){return MV(z,B.f8.payload[B.bE],B.bE)}}(H)),H.f8.type==="ENTITY_MUTATION_TYPE_DELETE"&&(J=function(B){return function(){return rm(z,B.f8.entityKey)}}(H)),H.f8.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(J=function(B){return function(){return S9K(z,B.f8.entityKey,B.f8.payload[B.bE],B.bE)}}(H)),J&&(U[H.f8.entityKey]=U[H.f8.entityKey]?U[H.f8.entityKey].then(J):J()));
return g.u4.all(Object.values(U))}),0):C.return()})},BJx=function(S){var b;
return g.O(function(C){if(C.J==1){b=S.mutations;if(!b||b.length<=0)return C.return();if(g.$B){var z={type:"ENTITY_LOADED"};b!==void 0&&(z.payload=b);g.$B.dispatch(z)}return g.l(C,HtO(b),2)}b.length=0;g.tz(C)})},sHX=function(S){return S!==void 0},x1O=function(S){var b=g.jH();
b=Object.assign({},b);S=Object.assign({},S);for(var C in b)S[C]?(b[C]!==4&&(b[C]=S[C]),delete S[C]):b[C]!==2&&(b[C]=4);Object.assign(b,S);g.z0C(b);JSON.stringify(b);return b},EpM=function(S){var b,C;
return g.O(function(z){if(z.J==1)return g.l(z,g.q6(),2);if(z.J!=3)return(b=z.K)?g.l(z,g.AG(b),3):z.return();C=z.K;return z.return(g.ji(C,["index","media","captions"],{mode:"readwrite",He:!0},function(U){var a=IDBKeyRange.bound(S+"|",S+"~");U=[U.objectStore("index").delete(a),U.objectStore("media").delete(a),U.objectStore("captions").delete(a)];return g.u4.all(U).then(function(){})}))})},d1L=function(){var S,b;
return g.O(function(C){if(C.J==1)return g.l(C,g.q6(),2);if(C.J!=3){S=C.K;if(!S)throw g.tA("rvdfd");return g.l(C,g.AG(S),3)}b=C.K;return C.return(g.ji(b,["index","media"],{mode:"readwrite",He:!0},function(z){var U={};return g.K5(z.objectStore("index"),{},function(a){var J=a.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),H=g.u4.resolve(void 0);if(J){var B=J[1];J=J[2];U[B]=U[B]||{};var x;U[B][J]=g.JD0((x=a.getValue())==null?void 0:x.fmts)}else H=a.delete().then(function(){});
return g.u4.all([g.Qc(a),H]).then(function(E){return g.t(E).next().value})}).then(function(){for(var a={},J=g.t(Object.keys(U)),H=J.next();!H.done;H=J.next()){H=H.value;
var B=U[H].v;a[H]=U[H].a&&B?1:2}var x=x1O(a);return g.lsN(z.objectStore("media"),{},function(E){var d=E.cursor.key.match(g.sXH);d&&a[d[1]]||z.objectStore("media").delete(E.cursor.key);return g.tsd(E)}).then(function(){return x})})}))})},p7L=function(S,b){var C,z;
return g.O(function(U){if(U.J==1)return g.l(U,g.q6(),2);if(U.J!=3){C=U.K;if(!C)throw g.tA("wct");return g.l(U,g.AG(C),3)}z=U.K;return g.l(U,g.ji(z,["captions"],{mode:"readwrite",He:!0},function(a){var J=[];a=a.objectStore("captions");for(var H=0;H<b.length;H++){var B=g.XC(a,b[H],S+"|"+b[H].metadata.vss_id);J.push(B)}return g.u4.all(J)}),0)})},FaM=function(S){var b,C,z;
return g.O(function(U){if(U.J==1)return b=IDBKeyRange.bound(S+"|",S+"~"),g.l(U,g.q6(),2);if(U.J!=3){C=U.K;if(!C)throw g.tA("gactfv");return g.l(U,g.AG(C),3)}z=U.K;return U.return(z.getAll("captions",b))})},TJK=function(S){return g.O(function(b){g.OU(S,0);
return b.return(EpM(S))})},VqM=function(S){return{context:g.Lz(),
videoIds:S}},Pzk=function(S){return{context:g.Lz(),
playlistIds:S}},tqx=function(S){return{context:g.Lz(),
offlinePlaylistSyncChecks:S}},kUm=function(){this.J=new Map},eTX=function(){uaO||(uaO=new kUm);
return uaO},GU1=function(S,b){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:S},metadata:b,statusCode:void 0,csn:void 0,can:void 0}},fVM=function(S,b,C){if(!C){var z=z===void 0?!1:z;
C=S.J.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!C||z)C=g.uZ(16),S.J.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",C)}S={flowNonce:C,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:b.eventType};b.metadata&&(S.flowMetadata=b.metadata);b.statusCode!==void 0&&(S.flowEventStatus=b.statusCode);b.csn&&(S.csn=b.csn);b.can&&(S.can=b.can);g.yc("flowEvent",S,void 0)},m1O=function(S){var b,C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8,mR,b6,o5,FX,G,f,W;
return g.O(function(A){if(A.J==1)return g.l(A,Ih(S,{mode:"readonly",He:!0},function(v){return gm(v,"playbackData").then(function(CN){var UH=CN.map(function(Jz){return Jz.transfer}).filter(function(Jz){return!!Jz}),o8=CN.map(function(Jz){return Jz.offlineVideoPolicy}).filter(function(Jz){return!!Jz}),Q=CN.filter(function(Jz){return!!Jz.key}).map(function(Jz){return g.q2(g.Lh(Jz.key).entityId,"downloadStatusEntity")});
UH=gm(v,"transfer",UH);o8=gm(v,"offlineVideoPolicy",o8);Q=gm(v,"downloadStatusEntity",Q);var km=UH.then(function(Jz){Jz=Jz.reduce(function(yX,OH){(OH==null?0:OH.offlineVideoStreams)&&yX.push.apply(yX,g.u(OH.offlineVideoStreams));return yX},[]).filter(function(yX){return!!yX});
return gm(v,"offlineVideoStreams",Jz)});
return g.u4.all([UH,o8,km,Q]).then(function(Jz){var yX=g.t(Jz);Jz=yX.next().value;var OH=yX.next().value;var wM=yX.next().value;yX=yX.next().value;return[CN,Jz,OH,wM,yX]})})}),2);
if(A.J!=3)return b=A.K,g.l(A,Ih(S,{mode:"readonly",He:!0},function(v){return gm(v,"mainDownloadsListEntity").then(function(CN){var UH,o8;return(o8=(UH=CN[0])==null?void 0:UH.downloads)!=null?o8:[]})}),3);
C=A.K;z=g.t(b);U=z.next().value;a=z.next().value;J=z.next().value;H=z.next().value;B=z.next().value;x=U;E=a;d=J;p=H;F=B;T={};k={};e={};m={};R={};X=[];K=g.t(E);for(N=K.next();!N.done;N=K.next())(b2=N.value)&&(T[b2.key]=b2);I=g.t(d);for($m=I.next();!$m.done;$m=I.next())(a8=$m.value)&&(k[a8.key]=a8);S0=g.t(F);for(Y=S0.next();!Y.done;Y=S0.next())(q=Y.value)&&(e[q.key]=q);P=g.t(p);for(r=P.next();!r.done;r=P.next())(QX=r.value)&&(m[QX.key]=QX);u6=g.t(C);for(d8=u6.next();!d8.done;d8=u6.next())mR=d8.value,
b6=void 0,R[(b6=mR.videoItem)!=null?b6:""]=!0,mR.videoItem&&(FX=o5=void 0,G=(FX=(o5=g.Lh(mR.videoItem))==null?void 0:o5.entityId)!=null?FX:"",X.push({externalVideoId:G}));f=x.filter(function(v){if(!v||!v.key||!v.offlineVideoPolicy)return!1;v=g.Lh(v.key).entityId;v=g.q2(v,"downloadStatusEntity");var CN;return!(v&&((CN=e[v])==null?void 0:CN.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
W=f.map(function(v){var CN=T[v.transfer],UH=[];if(CN==null?0:CN.offlineVideoStreams)for(var o8=g.t(CN.offlineVideoStreams),Q=o8.next();!Q.done;Q=o8.next())(Q=m[Q.value])&&UH.push(Q);o8=k[v.offlineVideoPolicy];Q=R;var km=v==null?void 0:v.playerResponseTimestamp,Jz=g.Lh(o8.key).entityId;v=g.q2(Jz,"mainVideoEntity");if(o8.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var yX="OFFLINE_VIDEO_STATE_DISABLED";o8.expirationTimestamp&&Number(o8.expirationTimestamp)<Date.now()/1E3&&(yX="OFFLINE_VIDEO_STATE_EXPIRED")}else if(o8.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")yX="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(CN==null?void 0:CN.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":yX="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":yX="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":yX="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":yX="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":yX="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":yX="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:yX="OFFLINE_VIDEO_STATE_UNKNOWN"}if(yX==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(CN==null?void 0:CN.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":yX="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":yX="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":yX=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Jz={id:Jz,videoState:yX};if(CN==null?0:CN.cotn)Jz.cotn=CN.cotn;if(CN==null?0:CN.maximumDownloadQuality)Jz.selectedVideoQuality=CN==null?void 0:CN.maximumDownloadQuality;if(CN==null?0:CN.lastProgressTimeMs)Jz.lastProgressTimeMs=CN.lastProgressTimeMs;km&&(Jz.playerResponseSavedTimeMs=String(Number(km)*1E3));CN=String;km=0;UH=g.t(UH);for(yX=UH.next();!yX.done;yX=UH.next())if(yX=yX.value,yX.streamsProgress){yX=g.t(yX.streamsProgress);for(var OH=yX.next();!OH.done;OH=
yX.next()){var wM=void 0;km+=Number((wM=OH.value.numBytesDownloaded)!=null?wM:0)}}Jz.downloadedBytes=CN(km);Jz.selectedOfflineMode=Q[v]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";o8.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Jz.offlinePlaybackDisabledReason=o8.offlinePlaybackDisabledReason);return Jz});
return A.return({offlineVideos:W,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:X}}})})},RTX=function(){this.locks=navigator.locks},Wal=function(){try{var S=g.Zj("ytglobal.locks_");
if(S)return S;var b;if(b=navigator){var C=navigator;b="locks"in C&&!!C.locks}if(b)return g.Ym.localStorage&&g.Ym.localStorage.getItem("noop"),S=new RTX,g.MC("ytglobal.locks_",S),S}catch(z){}},b0=function(){},lVl=function(){},jHm=function(S){if(S.includes(":"))throw Error("Invalid user cache name: "+S);
return S+":"+g.hq("CacheStorage get")},X7k=function(){return g.O(function(S){if(CY!==void 0)return S.return(CY);
CY=new Promise(function(b){var C;return g.O(function(z){switch(z.J){case 1:return g.u2(z,2),g.l(z,i0.open("test-only"),4);case 4:return g.l(z,i0.delete("test-only"),5);case 5:g.GV(z,3);break;case 2:if(C=g.fN(z),C instanceof Error&&C.name==="SecurityError")return b(!1),z.return();case 3:b("caches"in window),g.tz(z)}})});
return S.return(CY)})},AtM=function(){return g.O(function(S){if(S.J==1)return g.l(S,X7k(),2);
if(!S.K)return S.return(void 0);OtU||(OtU=new lVl);return S.return(OtU)})},zl=function(S,b,C){g.vq(new g.ZL("Woffle: "+S,C?{cotn:C}:""));
b instanceof Error&&g.vq(b)},vp2=function(S){var b;
return g.O(function(C){if(C.J==1)return g.l(C,m1O(S),2);b=C.K;g.yc("offlineStateSnapshot",b);g.tz(C)})},$f=function(S){g.D.call(this);
var b=this;this.api=S;this.FF={OyS:function(){return b.J},
zKE:function(){return b.K}};
typeof g.Ym.BroadcastChannel!=="undefined"&&(this.J=new g.Ym.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.hq()),this.J.onmessage=this.Y.bind(this),this.K=new g.Ym.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.hq()),this.K.onmessage=this.C.bind(this))},UL=function(S,b){S.api.xQ("onOfflineOperationFailure",b);
var C;(C=S.J)==null||C.postMessage(b)},KaL=function(S,b,C,z){var U=this;
this.X=S;this.j=b;this.visibility=C;this.L=z;this.D=this.T=this.B=this.Y=this.J=!1;this.C=new g.M8(function(){U.hc()});
this.FF={Gm:function(){return U.K},
hc:function(){U.hc()},
Awx:function(){return U.C}};
this.visibility.subscribe("visibilitystatechange",function(){U.va()})},QHX=function(S){if(!S.Y&&!S.J){var b=Wal();
if(b){S.Y=!0;var C=g.hq("OfflineLockManager");b.request("woffle_orchestration_leader:"+C,{},function(){var z,U,a,J;return g.O(function(H){switch(H.J){case 1:return g.u2(H,2),S.K=new g.H7,S.J=!0,S.Y=!1,g.l(H,S.X(),4);case 4:return g.l(H,S.K.promise,5);case 5:g.GV(H,0);break;case 2:z=g.fN(H),((a=(U=S).L)==null?0:a.call(U,"wo_relinquish_leadership_on_lock_request_error"))||S.hc(),z instanceof Error&&(J=z,J.args=[{name:"WoLockManagerError",Sf:z.name}],g.AQ(J)),g.tz(H)}})})}}},ctc=function(S){S.J&&(S.D=
!0,aa(S))},D1x=function(S,b){S.J&&(S.B=b,aa(S))},NJm=function(S,b){S.J&&(S.T=b,aa(S))},aa=function(S){S.T&&S.B&&S.D&&S.visibility.isBackground()?g.rK(S.C,6E4):S.C.stop()},oa=function(S){var b;
S.offlineDeleteReason=(b=S.offlineDeleteReason)!=null?b:"OFFLINE_DELETE_REASON_UNKNOWN";var C;S.offlineModeType=(C=S.offlineModeType)!=null?C:"OFFLINE_NOW";g.yc("offlineDeleteEvent",S)},Jy=function(S,b){var C=b.videoId;
var z=b.U3;b=b.offlineModeType;S.encryptedVideoId=C;S.cotn=z==null?void 0:z.cotn;S.offlineabilityFormatType=z==null?void 0:z.maximumDownloadQuality;var U;S.isRefresh=(U=z==null?void 0:z.isRefresh)!=null?U:!1;var a;S.softErrorCount=(a=z==null?void 0:z.transferRetryCount)!=null?a:0;S.offlineModeType=b!=null?b:"OFFLINE_NOW";(S.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&S.statusType==="UNKNOWN_STATUS_TYPE"||!S.transferStatusType&&!S.statusType)&&g.vq(Error("Woffle unknown transfer status"));
g.yc("offlineTransferStatusChanged",S)},npL=function(S){Jy({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},S)},gpl=function(S,b,C,z){z={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!z};b&&C&&(b=Math.floor(b/1024).toFixed(),C=Math.floor(C/1024).toFixed(),z.alreadyDownloadedKbytes=b,z.totalFetchedKbytes=b,z.totalContentKbytes=C);Jy(z,S)},Y9k=function(S){Jy({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},S)},MqM=function(S){Jy({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},S)},rtO=function(S){switch(S){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
yT=function(S){var b,C,z;
return((z=(b=S.actionMetadata)==null?void 0:(C=b.retryScheduleIntervalsInSeconds)==null?void 0:C.length)!=null?z:0)>0},HE=function(S){return S.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!S.entityKey},BE=function(S){return S.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!S.entityKey},sL=function(S){return S.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!S.entityKey},Ztc=function(S){return S.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!S.entityKey},
xf=function(S,b,C,z,U){U=U===void 0?!1:U;
var a,J,H,B,x,E;return g.O(function(d){if(d.J==1)return a=g.q2(S,b),J=g.q2(S,"downloadStatusEntity"),g.l(d,Ih(C,{mode:"readonly",He:!0},function(p){return g.u4.all([ni(p,a,b),ni(p,J,"downloadStatusEntity")])}),2);
H=d.K;B=H.length?H[0]:void 0;if(!B)return d.cS(0);x=hTk;if(E=H.length>1?H[1]:void 0){if(E.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!U)return d.return();E.downloadState=z}else E={key:J,downloadState:z};g.Nm(B,x,E);return g.l(d,Ih(C,{mode:"readwrite",He:!0},function(p){return g.u4.all([MV(p,B,b),MV(p,E,"downloadStatusEntity")])}),0)})},EL=function(S,b){return S.actionType===b.actionType&&S.entityKey===b.entityKey},dh=function(S,b){if(S&&S.transferState!=="TRANSFER_STATE_COMPLETE"&&S.transferState!==
"TRANSFER_STATE_FAILED"){var C=g.Lh(S.key).entityId;
Jy({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:C,U3:S,offlineModeType:b})}},pY=function(S){if(!S||!S.thumbnails)return[];
var b=[];S=g.t(S.thumbnails);for(var C=S.next();!C.done;C=S.next())C=C.value,C.url&&b.push(C.url);return b},IVl=function(S,b,C){C=C===void 0?[]:C;
var z,U,a,J,H,B,x,E,d,p,F,T,k;return g.O(function(e){if(e.J==1)return C.length?g.l(e,qV(S,b),2):e.return([]);z=e.K;U=new Set;a=g.t(z);for(J=a.next();!J.done;J=a.next())if(H=J.value,B=H.id||H.key)x=g.Lh(B).entityId,U.add(x);E=[];d=g.t(C);for(p=d.next();!p.done;p=d.next())F=p.value,T=F.offlineVideoData,k=void 0,((k=T)==null?0:k.videoId)&&!U.has(T.videoId)&&E.push(F);return e.return(E)})},w78=function(S,b,C){return new g.ZD(S,{cotn:b,
raw_player_response:C,download_media:!0,start:Infinity,disable_watch_next:!0})},La6=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},FU=function(S,b,C,z,U,a,J,H,B,x,E){this.entityType=S;
this.actionId=b;this.action=C;this.parentActionId=z;this.rootActionId=U===void 0?b:U;this.childActionIds=a;this.prereqActionId=J;this.postreqActionIds=H;this.hasChildActionFailed=x;this.retryScheduleIndex=0;this.J=E||Date.now();this.retryScheduleIndex=B||0},Tl=function(S){if(!S.key)throw Error("Entity key is required.");
if(!S.actionProto)throw Error("OfflineOrchestrationAction is required.");var b=g.Lh(S.key),C=g.Lh(S.actionProto.entityKey);return new FU(C.entityType,b.entityId,S.actionProto,S.parentActionId,S.rootActionId,S.childActionIds,S.prereqActionId,S.postreqActionIds,S.retryScheduleIndex,S.hasChildActionFailed,Number(S.enqueueTimeSec)*1E3)},VT=function(S){return{key:g.q2(S.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:S.action,parentActionId:S.parentActionId,rootActionId:S.rootActionId,childActionIds:S.childActionIds,prereqActionId:S.prereqActionId,postreqActionIds:S.postreqActionIds,retryScheduleIndex:S.retryScheduleIndex,hasChildActionFailed:S.hasChildActionFailed,enqueueTimeSec:(S.J/1E3).toFixed()}},q91=function(){var S;
return g.O(function(b){return b.J==1?g.l(b,AtM(),2):(S=b.K)?b.return(S.delete("yt-player-local-img")):b.return(!0)})},PE=function(S){var b,C;
return g.O(function(z){if(z.J==1)return g.l(z,AtM(),2);if(z.J!=3){b=z.K;if(!b)throw Error("Cache API not supported");return S.length?g.l(z,b.open("yt-player-local-img"),3):z.return()}C=z.K;return g.l(z,Promise.all(S.map(function(U){return C.delete(U)})),0)})},ty=function(S){var b,C;
return g.O(function(z){if(z.J==1)return g.l(z,AtM(),2);if(z.J!=3){b=z.K;if(!b)throw Error("Cache API not supported");return S.length?g.l(z,b.open("yt-player-local-img"),3):z.return()}C=z.K;return g.l(z,C.addAll(S),0)})},kf=function(S,b,C,z,U){var a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8,mR,b6;
return g.O(function(o5){switch(o5.J){case 1:return a=g.q2(S,"mainVideoEntity"),J=g.q2(S,"ytMainChannelEntity"),H=g.q2(S,"transfer"),B=g.q2(S,"videoDownloadContextEntity"),g.l(o5,Ih(b,{mode:"readonly",He:!0},function(FX){return g.u4.all([ni(FX,a,"mainVideoEntity"),ni(FX,J,"ytMainChannelEntity"),ni(FX,H,"transfer"),ni(FX,B,"videoDownloadContextEntity"),gm(FX,"ytMainChannelEntity"),gm(FX,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:x=o5.K;E=g.t(x);d=E.next().value;p=E.next().value;F=E.next().value;T=E.next().value;k=E.next().value;e=E.next().value;m=d;R=p;X=F;K=T;N=k;b2=e;if(!m&&!R){o5.cS(3);break}I=m?pY(m.thumbnail):[];if(!R){$m=[];o5.cS(4);break}return g.l(o5,SN6(R,N),5);case 5:$m=o5.K;case 4:return a8=$m,g.l(o5,PE(I.concat(a8)),3);case 3:S0=[];Y=g.q2(S,"downloadStatusEntity");q=g.t(b2);for(P=q.next();!P.done;P=q.next())r=P.value,QX=g.Lh(r.key).entityId,u6=Tl(r),d8=g.Lh(u6.action.entityKey).entityId,QX!==S&&d8!==S||
EL(C,r.actionProto)||S0.push(r.key);return g.l(o5,Ih(b,{mode:"readwrite",He:!0},function(FX){var G=S0.map(function(f){return rm(FX,f)});
G.push(rm(FX,a,{K$:!0}));G.push(rm(FX,Y,{K$:!0}));return g.u4.all(G)}),7);
case 7:b6=(mR=K)==null?void 0:mR.offlineModeType,U&&(oa(U),U.offlineModeType&&(b6=U.offlineModeType)),dh(X,b6),UL(z,{entityKey:a,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.tz(o5)}})},iHm=function(S,b,C,z){var U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8,mR,b6,o5,FX,G,f,W,A,v,CN,UH,o8,Q,km,Jz,yX,OH,wM,D1,w8;
return g.O(function(rM){switch(rM.J){case 1:return U=g.q2(S,"mainPlaylistEntity"),a=g.q2(S,"ytMainChannelEntity"),g.l(rM,Ih(b,{mode:"readonly",He:!0},function(h3){return g.u4.all([ni(h3,U,"mainPlaylistEntity"),ni(h3,a,"ytMainChannelEntity"),gm(h3,"mainPlaylistEntity"),gm(h3,"mainDownloadsListEntity"),gm(h3,"ytMainChannelEntity"),gm(h3,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:J=rM.K;H=g.t(J);B=H.next().value;x=H.next().value;E=H.next().value;d=H.next().value;p=H.next().value;F=H.next().value;T=B;k=x;e=E;m=d;R=p;X=F;if(!T&&!k){rM.cS(3);break}K=T?bHm(T):[];if(!k){N=[];rM.cS(4);break}return g.l(rM,SN6(k,R),5);case 5:N=rM.K;case 4:return b2=N,g.l(rM,PE(K.concat(b2)),3);case 3:I=[];$m=new Map;if(!T){rM.cS(7);break}return g.l(rM,CXX(T,e,m),8);case 8:I=rM.K;a8=g.t(I);for(S0=a8.next();!S0.done;S0=a8.next())Y=S0.value,$m.set(Y,{videoId:Y,playlistId:S,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.l(rM,Ih(b,{mode:"readonly",He:!0},function(h3){return g.u4.all([gm(h3,"transfer"),gm(h3,"videoDownloadContextEntity")])}),9);
case 9:q=rM.K;P=g.t(q);r=P.next().value;QX=P.next().value;u6=r;d8=QX;mR=g.t(u6);for(b6=mR.next();!b6.done;b6=mR.next())o5=b6.value,FX=g.Lh(o5.key).entityId,(G=$m.get(FX))&&o5&&(G.cotn=o5.cotn);f=g.t(d8);for(W=f.next();!W.done;W=f.next())A=W.value,v=g.Lh(A.key).entityId,(CN=$m.get(v))&&A&&(CN.offlineModeType=A.offlineModeType);case 7:UH=[];o8=g.t(X);for(Q=o8.next();!Q.done;Q=o8.next())km=Q.value,Jz=g.Lh(km.key).entityId,yX=Tl(km),Jz!==S&&yX.rootActionId!==S||EL(C,km.actionProto)||UH.push(km.key);OH=
g.q2(S,"mainPlaylistEntity");return g.l(rM,Ih(b,{mode:"readwrite",He:!0},function(h3){var Dg=UH.map(function(dq){return rm(h3,dq)});
Dg.push(rm(h3,OH,{K$:!0}));return g.u4.all(Dg)}),10);
case 10:if(!T){rM.cS(0);break}I.reverse();if(!I){rM.cS(0);break}wM=g.t(I);D1=wM.next();case 13:if(D1.done){rM.cS(0);break}w8=D1.value;return g.l(rM,kf(w8,b,C,z,$m.get(w8)),14);case 14:D1=wM.next(),rM.cS(13)}})},$86=function(S,b,C,z){var U,a,J,H,B,x,E,d,p;
return g.O(function(F){if(F.J==1)return U=g.q2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),a=new Map,g.l(F,Ih(S,{mode:"readwrite",He:!0},function(T){var k=gm(T,"transfer"),e=gm(T,"offlineOrchestrationActionWrapperEntity"),m=gm(T,"videoDownloadContextEntity"),R=ni(T,U,"mainDownloadsListEntity");return g.u4.all([k,e,m,R]).then(function(X){X=g.t(X);var K=X.next().value;var N=X.next().value;var b2=X.next().value;var I=X.next().value;X=z1x.map(function(a8){return qAx(T,a8)});
N=g.t(N);for(var $m=N.next();!$m.done;$m=N.next())$m=$m.value,EL(b,$m.actionProto)||X.push(rm(T,$m.key,{K$:!0}));I&&(I.downloads=[],X.push(MV(T,I,"mainDownloadsListEntity")));if(b2)for(b2=g.t(b2),I=b2.next();!I.done;I=b2.next())I=I.value,N=g.Lh(I.key).entityId,N=g.q2(N,"transfer"),a.set(N,I.offlineModeType);return g.u4.all(X).then(function(){return K})})}),2);
J=F.K;H=g.t(J);for(B=H.next();!B.done;B=H.next())x=B.value,dh(x,a.get(x.key)),E=g.Lh(x.key).entityId,d={videoId:E,offlineDeleteReason:z,cotn:x.cotn,offlineModeType:a.get(x.key)},oa(d),p=g.q2(E,"mainVideoEntity"),UL(C,{entityKey:p,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.l(F,q91(),0)})},bHm=function(S,b){var C=[];
if(S.thumbnailStyleData){S=g.t(S.thumbnailStyleData);for(var z=S.next();!z.done;z=S.next()){var U=void 0,a=void 0,J=void 0;C=C.concat(pY((U=z.value)==null?void 0:(a=U.value)==null?void 0:(J=a.collageThumbnail)==null?void 0:J.coverThumbnail))}}b=pY(b);return C.concat(b)},CXX=function(S,b,C){var z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8;
return g.O(function(S0){z=[];U=new Set;if(C.length)for(a=g.t(C),J=a.next();!J.done;J=a.next())if(H=J.value,B=void 0,(B=H.downloads)==null?0:B.length)for(x=g.t(H.downloads),E=x.next();!E.done;E=x.next())d=E.value,d.videoItem&&(p=g.Lh(d.videoItem).entityId,U.add(p));if(S.videos){F=g.t(S.videos);for(T=F.next();!T.done;T=F.next())k=T.value,e=JSON.parse(g.Lh(k).entityId),e.videoId&&!U.has(e.videoId)&&z.push(e.videoId);m=g.t(b);for(R=m.next();!R.done;R=m.next())if(X=R.value,X.key!==S.key&&(K=X.videos))for(N=
g.t(K),b2=N.next();!b2.done;b2=N.next())I=b2.value,$m=JSON.parse(g.Lh(I).entityId),$m.videoId&&(a8=z.indexOf($m.videoId),a8!==-1&&z.splice(a8,1))}return S0.return(z)})},SN6=function(S,b){var C,z,U,a,J,H,B,x;
return g.O(function(E){C=pY(S.avatar);z=g.t(b);for(U=z.next();!U.done;U=z.next())if(a=U.value,a.id!==S.id)for(J=g.t(pY(a.avatar)),H=J.next();!H.done;H=J.next())B=H.value,x=C.indexOf(B),x!==-1&&C.splice(x,1);return E.return(C)})},U8c=function(S){var b;
return g.O(function(C){b=g.M(S.frameworkUpdates,u0);return S.frameworkUpdates&&b?g.l(C,BJx(b),0):C.return()})},oEm=function(S){var b;
if((b=S.onResponseReceivedActions)!=null&&b.length){var C;S=(C=g.M(g.M(S.onResponseReceivedActions[0],a7x),g.Tqc))==null?void 0:C.actions;if(S!=null&&S.length)return S}},Jb6=function(S){var b,C,z;
return g.O(function(U){if(U.J==1)return S?g.l(U,Li(S,g.XO,"mainDownloadsListEntity"),2):U.return([]);b=U.K;return((C=b)==null?0:(z=C.downloads)==null?0:z.length)?U.return(b.downloads.map(function(a){var J;return(J=a.videoItem)!=null?J:""})):U.return([])})},HHK=function(S,b){var C;
return g.O(function(z){return z.J==1?g.l(z,ybl(S,b),2):(C=z.K)?g.l(z,Ih(S,{mode:"readwrite",He:!0},function(U){var a=[MV(U,C.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];C.mainDownloadsListEntity&&a.push(MV(U,C.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.u4.all(a)}),0):z.cS(0)})},ybl=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X;
return g.O(function(K){if(K.J==1)return C=g.q2("main_downloads_library_id","mainDownloadsLibraryEntity"),z=g.q2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.l(K,Ih(S,{mode:"readonly",He:!0},function(N){return g.u4.all([ni(N,C,"mainDownloadsLibraryEntity"),ni(N,z,"mainDownloadsListEntity")])}),2);
U=K.K;a=g.t(U);J=a.next().value;H=a.next().value;B=J;x=H;B||(B={id:C});E=g.t(b);for(d=E.next();!d.done;d=E.next())if(p=d.value,p===g.XO){if(B.smartDownloadsList)return K.return();B.smartDownloadsList=p}else if(F=g.Lh(p).entityType,T={},F==="mainPlaylistEntity"?T.playlistItem=p:F==="mainVideoEntity"&&(T.videoItem=p),!g.Z1(T)){k=void 0;if((k=x)==null?0:k.downloads){e=!1;m=g.t(x.downloads);for(R=m.next();!R.done;R=m.next())if(X=R.value,X.playlistItem===p||X.videoItem===p){e=!0;break}e||x.downloads.push(T)}else x=
{id:z,downloads:[T]};B.downloadsList=z}return K.return({mainDownloadsLibraryEntity:B,mainDownloadsListEntity:x})})},BK5=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e;
return g.O(function(m){if(m.J==1)return C=g.q2("main_downloads_library_id","mainDownloadsLibraryEntity"),z=g.q2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.l(m,Ih(S,{mode:"readonly",He:!0},function(R){return g.u4.all([ni(R,C,"mainDownloadsLibraryEntity"),ni(R,z,"mainDownloadsListEntity"),ni(R,g.XO,"mainDownloadsListEntity")])}),2);
U=m.K;a=g.t(U);J=a.next().value;H=a.next().value;B=a.next().value;x=J;E=H;d=B;if(!x)return m.cS(0);if(b===g.XO&&((p=d)==null?0:p.downloads))d.downloads=[];else if((F=E)==null?0:F.downloads)for(T=g.Lh(b).entityType,k=0;k<E.downloads.length;k++)if(e=E.downloads[k],T==="mainVideoEntity"&&e.videoItem===b){E.downloads.splice(k,1);break}else if(T==="mainPlaylistEntity"&&e.playlistItem===b){E.downloads.splice(k,1);break}return g.l(m,Ih(S,{mode:"readwrite",He:!0},function(R){var X=[MV(R,x,"mainDownloadsLibraryEntity")];
E&&X.push(MV(R,E,"mainDownloadsListEntity"));d&&X.push(MV(R,d,"mainDownloadsListEntity"));return g.u4.all(X)}),0)})},eF=function(S,b){var C,z,U,a,J,H,B,x,E,d,p;
return g.O(function(F){if(F.J==1)return C=g.q2(b,"transfer"),z=g.q2(b,"videoDownloadContextEntity"),g.l(F,Ih(S,{mode:"readonly",He:!0},function(T){return g.u4.all([ni(T,C,"transfer"),ni(T,z,"videoDownloadContextEntity")])}),2);
U=F.K;a=g.t(U);J=a.next().value;H=a.next().value;B=J;x=H;p={videoId:b,cotn:(E=B)==null?void 0:E.cotn,offlineModeType:(d=x)==null?void 0:d.offlineModeType};return F.return(p)})},Gl=function(S,b,C,z,U){var a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m;
return g.O(function(a8){switch(a8.J){case 1:return a=g.q2(S,"musicTrack"),J=g.q2(S,"transfer"),g.l(a8,Ih(b,{mode:"readonly",He:!0},function(S0){return g.u4.all([ni(S0,a,"musicTrack"),ni(S0,J,"transfer"),gm(S0,"musicTrack"),gm(S0,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:H=a8.K;B=g.t(H);x=B.next().value;E=B.next().value;d=B.next().value;p=B.next().value;F=x;T=E;k=d;e=p;if(!F){a8.cS(3);break}return g.l(a8,sLK(F,k),4);case 4:return m=a8.K,g.l(a8,PE(m),3);case 3:R=[];X=g.t(e);for(K=X.next();!K.done;K=X.next())N=K.value,b2=g.Lh(N.key).entityId,I=Tl(N),$m=g.Lh(I.action.entityKey).entityId,b2!==S&&$m!==S||EL(C,N.actionProto)||R.push(N.key);return g.l(a8,Ih(b,{mode:"readwrite",He:!0},function(S0){var Y=R.map(function(q){return rm(S0,q)});
Y.push(rm(S0,a,{K$:!0}));return g.u4.all(Y)}),6);
case 6:dh(T),U&&oa(U),UL(z,{entityKey:a,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.tz(a8)}})},fY=function(S,b,C,z,U){var a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8,mR,b6,o5,FX,G,f,W;
return g.O(function(A){switch(A.J){case 1:return a=g.q2(S,b),J=g.q2("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(A,Ih(C,{mode:"readonly",He:!0},function(v){return g.u4.all([ni(v,a,b),ni(v,J,"musicDownloadsLibraryEntity"),gm(v,b),gm(v,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:H=A.K;B=g.t(H);x=B.next().value;E=B.next().value;d=B.next().value;p=B.next().value;F=x;T=E;k=d;e=p;if(!F){A.cS(3);break}return g.l(A,sLK(F,k),4);case 4:return m=A.K,g.l(A,PE(m),3);case 3:R=[];X=new Map;if(!F){A.cS(6);break}return g.l(A,x82(F,k,T),7);case 7:R=A.K;K=g.t(R);for(N=K.next();!N.done;N=K.next())b2=N.value,I=g.Lh(b2).entityId,X.set(I,{videoId:I,playlistId:S,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.l(A,qV(C,"transfer"),8);case 8:for($m=A.K,a8=g.t($m),
S0=a8.next();!S0.done;S0=a8.next())Y=S0.value,q=g.Lh(Y.key).entityId,(P=X.get(q))&&Y&&(P.cotn=Y.cotn);case 6:r=[];QX=g.t(e);for(u6=QX.next();!u6.done;u6=QX.next())d8=u6.value,mR=g.Lh(d8.key).entityId,b6=Tl(d8),mR!==S&&b6.rootActionId!==S||EL(z,d8.actionProto)||r.push(d8.key);o5=g.q2(S,b);return g.l(A,Ih(C,{mode:"readwrite",He:!0},function(v){var CN=r.map(function(UH){return rm(v,UH)});
CN.push(rm(v,o5,{K$:!0}));return g.u4.all(CN)}),9);
case 9:if(!F){A.cS(0);break}R.reverse();if(!R.length){A.cS(0);break}FX=g.t(R);G=FX.next();case 12:if(G.done){A.cS(0);break}f=G.value;W=g.Lh(f).entityId;if(!W){A.cS(13);break}return g.l(A,Gl(W,C,z,U,X.get(W)),13);case 13:G=FX.next(),A.cS(12)}})},mI=function(S,b,C){var z,U,a,J,H,B,x;
return g.O(function(E){if(E.J==1)return g.l(E,Ih(S,{mode:"readwrite",He:!0},function(d){var p=gm(d,"transfer"),F=gm(d,"offlineOrchestrationActionWrapperEntity");return g.u4.all([p,F]).then(function(T){T=g.t(T);var k=T.next().value;var e=T.next().value;T=EEc.map(function(K){return qAx(d,K)});
e=g.t(e);for(var m=e.next();!m.done;m=e.next()){m=m.value;var R=g.Lh(m.actionProto.entityKey).entityType==="musicTrack",X=m.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";EL(b,m.actionProto)||R&&(!R||X)||T.push(rm(d,m.key,{K$:!0}))}return g.u4.all(T).then(function(){return k})})}),2);
z=E.K;U=g.t(z);for(a=U.next();!a.done;a=U.next())J=a.value,dh(J),H=g.Lh(J.key).entityId,B={videoId:H,offlineDeleteReason:void 0,cotn:J.cotn},oa(B),x=g.q2(H,"musicTrack"),UL(C,{entityKey:x,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.l(E,q91(),0)})},d8m=function(S){for(var b,C=g.t(S.additionalMetadatas),z=C.next();!z.done;z=C.next())z=z.value,z.offlineMusicVideoData&&(b=z.offlineMusicVideoData);
var U,a,J,H,B;return{id:g.q2(S.videoId,"musicTrack"),videoId:S.videoId,title:S.title,thumbnailDetails:S.thumbnail,lengthMs:String(Number(S.lengthSeconds)*1E3),albumTitle:(U=b)==null?void 0:U.releaseTitle,musicVideoType:(a=b)==null?void 0:a.musicVideoType,contentRating:{explicitType:(J=b)==null?void 0:J.explicitType},artistNames:((H=b)==null?void 0:H.byline)||((B=b)==null?void 0:B.channelName),downloadMetadata:g.q2(S.videoId,"musicTrackDownloadMetadataEntity")}},x82=function(S,b,C){var z,U,a,J,H,B,
x,E,d,p,F,T,k,e,m,R,X,K;
return g.O(function(N){z=[];U=new Set;if((a=C)==null?0:(J=a.downloadedTracks)==null?0:J.length)for(H=g.t(C.downloadedTracks),B=H.next();!B.done;B=H.next())x=B.value,U.add(x);if(S.tracks){E=g.t(S.tracks);for(d=E.next();!d.done;d=E.next())p=d.value,U.has(p)||z.push(p);F=g.t(b);for(T=F.next();!T.done;T=F.next())if(k=T.value,k.id!==S.id&&(e=k.tracks))for(m=g.t(e),R=m.next();!R.done;R=m.next())X=R.value,K=z.indexOf(X),K!==-1&&z.splice(K,1)}return N.return(z)})},sLK=function(S,b){var C,z,U,a,J,H,B,x;
return g.O(function(E){C=pY(S.thumbnailDetails);z=g.t(b);for(U=z.next();!U.done;U=z.next())if(a=U.value,a.id!==S.id)for(J=g.t(pY(a.thumbnailDetails)),H=J.next();!H.done;H=J.next())B=H.value,x=C.indexOf(B),x!==-1&&C.splice(x,1);return E.return(C)})},pM6=function(S,b){var C,z,U,a,J,H,B,x,E;
return g.O(function(d){if(d.J==1)return C=g.q2("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(d,Li(S,C,"musicDownloadsLibraryEntity"),2);(z=d.K)||(z={id:C});U=g.Lh(b).entityType;U==="musicTrack"?(a=z.downloadedTracks)!=null&&a.includes(b)||(z.downloadedTracks=((J=z.downloadedTracks)!=null?J:[]).concat(b)):U==="musicPlaylist"?(H=z.downloadedPlaylists)!=null&&H.includes(b)||(z.downloadedPlaylists=((B=z.downloadedPlaylists)!=null?B:[]).concat(b)):U!=="musicAlbumRelease"||(x=z.downloadedAlbumReleases)!=
null&&x.includes(b)||(z.downloadedAlbumReleases=((E=z.downloadedAlbumReleases)!=null?E:[]).concat(b));return g.l(d,wm(S,z,"musicDownloadsLibraryEntity"),0)})},FZ1=function(S,b){var C,z,U,a,J,H,B;
return g.O(function(x){if(x.J==1)return C=g.q2("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(x,Li(S,C,"musicDownloadsLibraryEntity"),2);z=x.K;if(!z)return x.cS(0);U=g.Lh(b).entityType;U==="musicTrack"?a=z.downloadedTracks:U==="musicPlaylist"&&(a=z.downloadedPlaylists);if((J=a)==null?0:J.length)for(H=0;H<a.length;H++)if(B=a[H],B===b){a.splice(H,1);break}return g.l(x,wm(S,z,"musicDownloadsLibraryEntity"),0)})},TKl=function(S){var b=S.videos;
S=[];var C=[];if(b){b=g.t(b);for(var z=b.next();!z.done;z=b.next()){var U=z.value.offlineVideoData.videoId;z=g.q2(U,"musicTrack");U=g.q2(U,"musicTrackDownloadMetadataEntity");S.push(z);C.push(U)}}return{hQ:S,oO:C}},Ra=function(S,b,C){b={track:d8m(b)};
C&&(b.playlistId=C);if(S=g.M(S.actionMetadata,Vrk))b.maximumDownloadQuality=S.maximumDownloadQuality;return{musicTrackEntityActionMetadata:b}},tr5=function(S){var b,C,z,U,a,J,H,B;
return g.O(function(x){switch(x.J){case 1:return b=g.UX(),C=VqM(S),z=g.b5(PXl),g.u2(x,2),a={nS:!0},g.l(x,g.h0(b,C,z,void 0,a),4);case 4:U=x.K;g.GV(x,3);break;case 2:J=g.fN(x);if(J instanceof g.i7)throw H="GetOffline network manager error: "+J.message,zl(H,J),Error(H);zl("GetOffline fetch request error",J);throw Error("GetOffline fetch request error");case 3:B=WE(U);if(!U)throw zl("Network request failed"),Error("Network request failed");if(B!==void 0)l0(B);else if(!U.videos||!U.videos.length)throw zl("No data"),
Error("No data");return x.return(U.videos.map(function(E){return E.offlineVideoData}))}})},kW1=function(S){var b,C,z,U,a,J,H,B;
return g.O(function(x){switch(x.J){case 1:return b=g.UX(),C=Pzk(S),z=g.b5(PXl),g.u2(x,2),a={nS:!0},g.l(x,g.h0(b,C,z,void 0,a),4);case 4:U=x.K;g.GV(x,3);break;case 2:J=g.fN(x);if(J instanceof g.i7)throw H="GetOffline network manager error for playlist: "+J.message,zl(H,J),Error(H);zl("GetOffline fetch request error for playlist",J);throw Error("GetOffline fetch request error for playlist");case 3:B=WE(U);if(!U)throw zl("Network request failed for playlist"),Error("Network request failed for playlist");
if(B!==void 0)l0(B,"playlist");else if(!U.playlists||!U.playlists.length)throw zl("No data for playlist"),Error("No data for playlist");return x.return(U.playlists.map(function(E){return E.offlinePlaylistData}))}})},e15=function(S,b,C,z){var U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8;
return g.O(function(mR){switch(mR.J){case 1:return g.l(mR,SF(),2);case 2:U=mR.K;if(!U)return mR.return([]);a=[];if((J=z)==null?0:J.length){a=z;mR.cS(3);break}return g.l(mR,qV(U,"mainPlaylistEntity"),4);case 4:a=mR.K;case 3:if(!a.length)return mR.return([]);H=[];B=Date.now()/1E3;x=g.t(a);E=x.next();case 5:if(E.done)return H.length?g.l(mR,uW8(H),10):mR.return([]);d=E.value;if(!d.downloadState){p=void 0;mR.cS(8);break}return g.l(mR,Li(U,d.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:p=
mR.K;case 8:F=p;T=void 0;e=(k=(T=d)==null?void 0:T.entityMetadata)&&k.nextAutoRefreshIntervalSeconds?Number(k.nextAutoRefreshIntervalSeconds):NaN;m=Number.isNaN(e)?S:e;X=R=void 0;K=((R=F)==null?0:R.lastSyncedTimestampMillis)?Number((X=F)==null?void 0:X.lastSyncedTimestampMillis)/1E3:0;b2=N=void 0;I=((N=F)==null?0:N.addedTimestampMillis)?Number((b2=F)==null?void 0:b2.addedTimestampMillis)/1E3:0;if(C||!k||K+m<=B){$m=[];a8=void 0;if((a8=d.videos)==null?0:a8.length)for(S0=g.t(d.videos),Y=S0.next();!Y.done;Y=
S0.next())q=Y.value,P=JSON.parse(g.Lh(q).entityId),P.videoId&&$m.push(P.videoId);r="0";k&&(QX=void 0,r=String(Number((QX=k.offlineLastModifiedTimestampSeconds)!=null?QX:0).toFixed()));u6={playlistId:d.playlistId,videoIds:$m,offlineLastModifiedTimestamp:r,autoSync:b,offlineDateAddedTimestamp:String(I.toFixed())};H.push(u6)}E=x.next();mR.cS(5);break;case 10:return d8=mR.K,mR.return(d8)}})},GWK=function(){var S,b,C,z,U;
return g.O(function(a){if(a.J==1)return g.l(a,SF(),2);if(a.J!=3)return(S=a.K)?g.l(a,qV(S,"refresh"),3):a.return(!1);b=a.K;if((C=b[0])==null||!C.refreshTime)return a.return(!1);z=Number(b[0].refreshTime);U=Date.now()/1E3;return a.return(isFinite(z)&&U>=z)})},m8x=function(S,b){var C,z,U;
return g.O(function(a){switch(a.J){case 1:return g.u2(a,2),g.l(a,f76(S,b),4);case 4:return z=a.K,g.l(a,U8c(z),5);case 5:C=oEm(z);g.GV(a,3);break;case 2:U=g.fN(a),zl("getAndProcessSmartDownloadsResponse request or processing error",U);case 3:return a.return(C)}})},R1c=function(S,b,C,z){var U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8;
return g.O(function(mR){switch(mR.J){case 1:return g.l(mR,SF(),2);case 2:U=mR.K;if(!U)return mR.return([]);a=[];if((J=z)==null?0:J.length){a=z;mR.cS(3);break}return g.l(mR,qV(U,"musicPlaylist"),4);case 4:a=mR.K;case 3:if(!a.length)return mR.return([]);H=[];B=Date.now()/1E3;x=g.t(a);E=x.next();case 5:if(E.done)return H.length?g.l(mR,uW8(H),10):mR.return([]);d=E.value;p=void 0;T=(F=(p=d)==null?void 0:p.entityMetadata)&&F.nextAutoRefreshIntervalSeconds?Number(F.nextAutoRefreshIntervalSeconds):NaN;k=
Number.isNaN(T)?S:T;m=e=0;R="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!d.downloadMetadata){mR.cS(8);break}return g.l(mR,Li(U,d.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:X=mR.K,N=K=void 0,e=Number((N=(K=X)==null?void 0:K.addedTimestampMillis)!=null?N:"0")/1E3,I=b2=void 0,m=Number((I=(b2=X)==null?void 0:b2.lastModifiedTimestampMillis)!=null?I:"0")/1E3,a8=$m=void 0,R=(a8=($m=X)==null?void 0:$m.syncState)!=null?a8:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:S0=void 0;if(C||R!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!F||Number((S0=F.lastSyncedTimestampSeconds)!=null?S0:0)+k<=B){Y=[];q=void 0;if((q=d.tracks)==null?0:q.length)for(P=g.t(d.tracks),r=P.next();!r.done;r=P.next())QX=r.value,Y.push(g.Lh(QX).entityId);u6={playlistId:d.playlistId,videoIds:Y,offlineLastModifiedTimestamp:String(m.toFixed()),autoSync:b,offlineDateAddedTimestamp:String(e.toFixed())};H.push(u6)}E=x.next();mR.cS(5);break;case 10:return d8=mR.K,mR.return(d8)}})},f76=function(S,b){var C,z,U,a,J,H,B,x,E,d;
return g.O(function(p){switch(p.J){case 1:return C=g.UX(),g.l(p,SF(),2);case 2:z=p.K;if(!z){p.cS(3);break}return g.l(p,m1O(z),4);case 4:U=p.K;case 3:var F=U;a={context:g.Lz(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:S},offlineClientState:F,clientStateRequestData:{preferredFormatType:b}}}};J=g.b5(WZM);g.u2(p,5);B={nS:!0};return g.l(p,g.h0(C,a,J,void 0,B),7);case 7:H=p.K;g.GV(p,6);break;case 5:x=g.fN(p);if(x instanceof g.i7)throw E=
"DPS network manager error for smart downloads: "+x.message,zl(E,x),Error(E);zl("DPS fetch request error for smart downloads",x);throw Error("DPS fetch request error for smart downloads");case 6:d=WE(H);if(H)d!==void 0&&l0(d,"smart downloads");else throw zl("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return p.return(H)}})},jL2=function(S,b){var C,z,U,a,J,H,B,x;
return g.O(function(E){switch(E.J){case 1:return C=g.UX(),z={context:g.Lz(),videoPlaybackPositionEntities:S,lastSyncTimestampUsec:b},U=g.b5(l78),g.u2(E,2),J={nS:!0},g.l(E,g.h0(C,z,U,void 0,J),4);case 4:a=E.K;g.GV(E,3);break;case 2:H=g.fN(E);if(H instanceof g.i7)throw B="VPPS network manager error: "+H.message,zl(B,H),Error(B);zl("VPPS fetch request error",H);throw Error("VPPS fetch request error");case 3:x=WE(a);if(a)x!==void 0&&l0(x,"position sync");else throw zl("Network request failed for position sync"),
Error("Network request failed for position sync");return E.return(a)}})},OHl=function(S,b,C){var z,U,a,J,H,B,x,E;
return g.O(function(d){switch(d.J){case 1:z=g.UX();var p=C.refreshData,F=C.isEnqueuedForExpiredStreamUrlRefetch,T=C.Xh,k=C.offlineSourceData,e=C.mediaCapabilities,m={entityKey:S};p&&(m.refreshData=p);F&&(m.isExpiredStreamUrlRefetch=F);T&&(m.downloadParameters=T);k&&(m.offlineSourceData=k);p={context:g.yn(b),signatureTimestamp:20187,videos:[m]};e&&(p.mediaCapabilities=e);U=p;a=g.b5(XMm);g.u2(d,2);H={nS:!0};return g.l(d,g.h0(z,U,a,void 0,H),4);case 4:J=d.K;g.GV(d,3);break;case 2:B=g.fN(d);if(B instanceof
g.i7)throw x="GetPDE network manager error: "+B.message,zl(x,B),Error(x);zl("GetPDE fetch request error",B);throw Error("GetPDE fetch request error");case 3:E=WE(J);if(J)E!==void 0&&l0(E,"PDE");else throw zl("Network request failed for PDE"),Error("Network request failed for PDE");return d.return(J)}})},WE=function(S){var b;
return(b=S.errorMetadata)==null?void 0:b.status},l0=function(S,b){b=b?" for "+b:"";
if(S===0)throw S="Empty response body"+b,zl(S),Error(S);S="Response with error"+b;zl(S);throw Error(S);},uW8=function(S){var b,C,z,U,a,J,H,B;
return g.O(function(x){switch(x.J){case 1:return b=g.UX(),C=tqx(S),z=g.b5(Abk),g.u2(x,2),a={nS:!0},g.l(x,g.h0(b,C,z,void 0,a),4);case 4:U=x.K;g.GV(x,3);break;case 2:J=g.fN(x);if(J instanceof g.i7)throw H="offlinePlaylistSyncCheck network manager error: "+J.message,zl(H,J),Error(H);zl("offlinePlaylistSyncCheck fetch request error",J);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:B=WE(U);if(!U)throw zl("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(B!==void 0)l0(B,"playlist sync");else if(!U.offlinePlaylistSyncCheckDatas||!U.offlinePlaylistSyncCheckDatas.length)throw zl("No data for playlist sync"),Error("No data for playlist sync");return x.return(U.offlinePlaylistSyncCheckDatas.map(function(E){return E.offlinePlaylistSyncCheckData}))}})},jF=function(S){this.J=S},vEX=function(S,b){var C,z,U,a,J,H;
return g.O(function(B){switch(B.J){case 1:C=new Map,z=g.t(b),U=z.next();case 2:if(U.done){B.cS(4);break}a=U.value;J=C;H=J.set;return g.l(B,S.K(a),5);case 5:H.call(J,a,B.K);U=z.next();B.cS(2);break;case 4:return B.return(C)}})},XU=function(S,b,C,z,U,a){b=g.q2(b,C);
z=Object.assign({},a,{priority:z,retryScheduleIntervalsInSeconds:U});return{actionType:S,entityKey:b,actionMetadata:z}},OL=function(S,b,C,z,U,a){this.status=S;
this.J=b;this.C=C;this.K=z;this.Y=U;this.downloadState=a},KZl=function(S,b,C){this.J=S;
this.JB=b;this.Y=C},D8L=function(S,b){var C,z,U,a,J,H,B,x,E;
return g.O(function(d){switch(d.J){case 1:return C=b.entityKey,U=(z=g.M(b.actionMetadata,Ay))==null?void 0:z.isEnqueuedForExpiredStreamUrlRefetch,g.u2(d,2),a=void 0,g.l(d,QLm(S,b),4);case 4:a=d.K;g.u2(d,5);var p=(p=g.M(b.actionMetadata,Ay))?{maximumDownloadQuality:p.maximumDownloadQuality}:void 0;return g.l(d,OHl(C,S.JB,{isEnqueuedForExpiredStreamUrlRefetch:U,Xh:p,offlineSourceData:a}),7);case 7:J=d.K;g.GV(d,6,2);break;case 5:return g.fN(d,2),H=yT(b)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",zl("PDE handleAdd error"),d.return(vE(b,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",H,"DOWNLOAD_STATE_FAILED"));case 6:return g.l(d,cbc(S,J,b),8);case 8:return d.return(vE(b,!0,J.orchestrationActions));case 2:return B=g.fN(d),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.p5&&B.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),zl("PDE handleAdd error"),d.return(vE(b,!1,void 0,x,E,"DOWNLOAD_STATE_FAILED"))}})},gEl=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8;
return g.O(function(S0){switch(S0.J){case 1:return C=b.entityKey,z=g.Lh(C).entityId,g.l(S0,Ih(S.J,{mode:"readonly",He:!0},function(Y){var q=ni(Y,C,"playbackData"),P=ni(Y,g.q2(z,"offlineVideoPolicy"),"offlineVideoPolicy");Y=ni(Y,g.q2(z,"transfer"),"transfer");return g.u4.all([q,P,Y])}),2);
case 2:U=S0.K;a=g.t(U);J=a.next().value;H=a.next().value;B=a.next().value;x=J;E=H;d=B;if(!x||!E)return S0.return(vE(b,!0));p=[];k=((T=x)==null?0:T.playerResponseJson)?JSON.parse(x.playerResponseJson):null;if(!(d&&k&&S.JB.L("html5_refresh_deprecated_downloads"))){S0.cS(3);break}F=NK6(S,k,d);return g.l(S0,nEl(S,d),4);case 4:p=S0.K;case 3:e={lastPlayerResponseTimestampSeconds:x.playerResponseTimestamp,offlineToken:E.offlineToken,formatIds:p};m={};if((R=d)==null?0:R.maximumDownloadQuality)m.maximumDownloadQuality=
d.maximumDownloadQuality;g.u2(S0,5);X=void 0;return g.l(S0,QLm(S,b),7);case 7:return X=S0.K,g.u2(S0,8),g.l(S0,OHl(C,S.JB,{refreshData:e,Xh:m,offlineSourceData:X,mediaCapabilities:F}),10);case 10:K=S0.K;g.GV(S0,9,5);break;case 8:return g.fN(S0,5),N=yT(b)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",zl("PDE handleRefresh error"),S0.return(vE(b,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",N,
"DOWNLOAD_STATE_FAILED"));case 9:return g.l(S0,cbc(S,K,b),11);case 11:return S0.return(vE(b,!0,K.orchestrationActions));case 5:return b2=g.fN(S0),I="PDE handleRefresh error",b2 instanceof Error&&(I="PDE handleRefresh error: "+b2.message),$m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a8="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b2 instanceof g.p5&&b2.type==="QUOTA_EXCEEDED"&&($m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a8="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
zl(I),S0.return(vE(b,!1,void 0,$m,a8,"DOWNLOAD_STATE_FAILED"))}})},QLm=function(S,b){var C,z,U,a;
return g.O(function(J){if(J.J==1)return C=g.Lh(b.entityKey).entityId,z=g.q2(C,"videoDownloadContextEntity"),g.l(J,Li(S.J,z,"videoDownloadContextEntity"),2);U=J.K;return(a=U)!=null&&a.offlineModeType?J.return({offlineModeType:U.offlineModeType}):J.return(void 0)})},cbc=function(S,b,C){var z,U,a,J,H;
return g.O(function(B){if(B.J==1){if(!b.frameworkUpdates||!g.M(b.frameworkUpdates,u0))return B.return();if(!(g.M(b.frameworkUpdates,u0).mutations&&g.M(b.frameworkUpdates,u0).mutations.length>0&&g.M(b.frameworkUpdates,u0).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return B.cS(2);z=g.Lh(g.M(b.frameworkUpdates,u0).mutations[0].entityKey).entityId;return g.l(B,eF(S.J,z),3)}if(B.J!=2){U=B.K;a=g.M(C.actionMetadata,Ay);if(H=(J=a)==null?void 0:J.playlistId)U.playlistId=H;U.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.SH(S.JB)?g.l(B,kf(z,S.J,C,S.Y,U),2):g.QG(S.JB)?g.l(B,Gl(z,S.J,C,S.Y),2):B.cS(2)}return g.l(B,BJx(g.M(b.frameworkUpdates,u0)),0)})},vE=function(S,b,C,z,U,a){return new OL(b?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",yT(S),C,z,U,a)},NK6=function(S,b,C){b=w78(S.JB,C.cotn,b);
C=g.HY(b);return g.wL0(b,C,S.JB)},nEl=function(S,b){var C,z,U,a,J,H,B,x,E,d,p;
return g.O(function(F){if(F.J==1)return C=[],g.l(F,Ih(S.J,{mode:"readonly",He:!0},function(T){var k=[],e=b.offlineVideoStreams;if(e){e=g.t(e);for(var m=e.next();!m.done;m=e.next())k.push(ni(T,m.value,"offlineVideoStreams"))}return g.u4.all(k)}),2);
if(z=F.K)for(U=g.t(z),a=U.next();!a.done;a=U.next())if(J=a.value,H=void 0,(H=J)==null?0:H.streamsProgress)for(B=J.streamsProgress,x=0;x<B.length;x++)E=B[x],d=JSON.parse(E.formatStreamBytes),p={itag:d.itag,lmt:d.lastModified,xtags:d.xtags},C.push(p);return F.return(C)})},YNc=function(S,b){this.J=S;
this.JB=b},MrU=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F;
return g.O(function(T){switch(T.J){case 1:return C=yT(b),g.l(T,qV(S.J,"videoPlaybackPositionEntity"),2);case 2:z=T.K;if(z.length===0)return T.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.u2(T,3);return g.l(T,ce.getInstance(),5);case 5:U=T.K;if(!U)throw Error("prefStorage is undefined");return g.l(T,U.get("psi"),6);case 6:return a=T.K,B=(H=(J=a)==null?void 0:J.Em)!=null?H:"0",g.l(T,jL2(z,B),7);case 7:return x=T.K,E={isPaused:x.watchHistoryPaused,Em:x.syncTimestampUsec},g.l(T,U.set("psi",
E),8);case 8:if(E.isPaused){T.cS(9);break}d=g.M(x.frameworkUpdates,u0);if(!x.frameworkUpdates||!d){T.cS(9);break}return g.l(T,BJx(d),9);case 9:g.GV(T,4);break;case 3:return p=g.fN(T),F="PPE handleRefresh error: "+(p instanceof Error?p.message:"unknown error"),zl(F),T.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},ZHK=function(S,b){var C,z,U,a,J,H,B,x;
return g.O(function(E){switch(E.J){case 1:return C=yT(b),z=g.Lh(b.entityKey).entityId,g.u2(E,2),g.l(E,ce.getInstance(),4);case 4:U=E.K;if(!U)throw Error("prefStorage is undefined");return g.l(E,U.get("psi"),5);case 5:a=E.K;J=g.M(b.actionMetadata,rbU);if(((H=a)==null?void 0:H.isPaused)!==!1||(B=J)==null||!B.lastPlaybackPositionSeconds){E.cS(6);break}x={key:g.q2(z,"videoPlaybackPositionEntity"),videoId:z,lastPlaybackPositionSeconds:J.lastPlaybackPositionSeconds};return g.l(E,wm(S.J,x,"videoPlaybackPositionEntity"),
6);case 6:g.GV(E,3);break;case 2:return g.fN(E),E.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},h16=function(S,b){var C,z,U;
return g.O(function(a){switch(a.J){case 1:C=yT(b);g.u2(a,2);z=g.Lh(b.entityKey).entityId;if(z==="!*$_ALL_ENTITIES_!*$")return g.l(a,aVM(S.J),5);U=g.q2(z,"videoPlaybackPositionEntity");return g.l(a,U1U(S.J,U),5);case 5:g.GV(a,3);break;case 2:return g.fN(a),a.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},I7L=function(S,b){this.api=S;
this.J=b;this.logger=new g.sa("woffle");this.K=!1;this.FF={Hb:this.Hb};this.logger.debug("Initialized OfflineMediaManager")},wMk=function(S){return g.O(function(b){return b.return(TJK(S))})},LZK=function(S){var b;
return g.O(function(C){if(C.J==1)return g.l(C,g.yDN(S),2);b=C.K;return C.return(b.filter(function(z){return!!z.url}).map(function(z){return z.url}))})},KY=function(S,b){var C=g.Xp(b);
if(C===1||C===0)return Promise.resolve();(C=qNc(S,b))&&C.stopVideo();S.Y=0;return wMk(b)},QT=function(S,b,C,z){C=C===void 0?!1:C;
z=z===void 0?!0:z;var U=typeof b==="string"?b:b.videoDetails.videoId;g.Xp(U)===2&&((b=qNc(S,U))?b.stopVideo():S.logger.info(function(){return"Corresponding player for "+U+" not found. Pausing anyway"}),g.OU(U,2),S.Y=2,C?Sp2(S.J):z&&bG5(S.J))},qNc=function(S,b){var C;
return((C=S.player)==null?void 0:C.getVideoData().videoId)===b?S.player:null},CnU=function(S,b,C){b.getPlayerResponse();
g.OU(b.videoId,2);S.Y=2;S.K=!1;var z;(z=S.player)==null||z.dispose();S.player=S.api.cJ(b);b={};S.player.BV((b.localmediachange=S.Ae,b.signatureexpired=S.x9,b.statechange=S.BYH,b),S);var U=S.Hb(C);S.player.RN(g.sK(U,U,!0,"m"),!1);S.logger.debug(function(){return"Starting headless playback with quality: "+U});
S.player.Li(!1)},iG2=function(S,b){this.J=S;
this.JB=b},$p6=function(S,b){var C,z;
return g.O(function(U){switch(U.J){case 1:return C=yT(b),g.l(U,Li(S.J,b.entityKey,"transfer"),2);case 2:if(z=U.K)return U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.u2(U,3);return g.l(U,zXX(S,b),5);case 5:g.GV(U,4);break;case 3:return g.fN(U),U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},Upc=function(S,b){var C,z;
return g.O(function(U){switch(U.J){case 1:return C=yT(b),g.l(U,Li(S.J,b.entityKey,"transfer"),2);case 2:z=U.K;if(!z||z.transferState!=="TRANSFER_STATE_COMPLETE")return U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.u2(U,3);return g.l(U,zXX(S,b,!0),5);case 5:g.GV(U,4);break;case 3:return g.fN(U),U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},asc=function(S,b){var C,z,U,a,J,H,B,x,E,d;
return g.O(function(p){switch(p.J){case 1:return C=yT(b),z=g.Lh(b.entityKey).entityId,g.l(p,Ih(S.J,{mode:"readonly",He:!0},function(F){var T=ni(F,b.entityKey,"transfer");F=ni(F,g.q2(z,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.u4.all([T,F])}),2);
case 2:U=p.K;a=g.t(U);J=a.next().value;H=a.next().value;B=J;x=H;if(!B||B.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return p.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.u2(p,3);B.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.l(p,wm(S.J,B,"transfer"),5);case 5:E=g.Lh(B.key).entityId;Y9k({videoId:E,U3:B,offlineModeType:(d=x)==null?void 0:d.offlineModeType});g.GV(p,4);break;case 3:return g.fN(p),p.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return p.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},zXX=function(S,b,C){C=C===void 0?!1:C;
var z,U,a,J,H,B,x,E,d,p,F,T,k,e,m;return g.O(function(R){switch(R.J){case 1:return z=g.M(b.actionMetadata,ogL),U=g.Lh(b.entityKey).entityId,a=g.q2(U,"downloadStatusEntity"),g.l(R,Ih(S.J,{mode:"readonly",He:!0},function(X){var K=ni(X,a,"downloadStatusEntity");X=ni(X,g.q2(U,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.u4.all([K,X])}),2);
case 2:return J=R.K,H=g.t(J),B=H.next().value,x=H.next().value,E=B,d=x,p="TRANSFER_STATE_TRANSFER_IN_QUEUE",((F=E)==null?void 0:F.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(p="TRANSFER_STATE_PAUSED_BY_USER"),e={key:b.entityKey,transferState:p,cotn:g.uZ(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(T=z)==null?void 0:T.maximumDownloadQuality,preferredAudioTrack:(k=z)==null?void 0:k.preferredAudioTrack,transferRetryCount:0,isRefresh:C,hasLoggedFirstStarted:!1},g.l(R,Ih(S.J,
{mode:"readwrite",He:!0},function(X){var K=[];C&&K.push(rm(X,g.q2(U,"offlineVideoStreams")));K.push(MV(X,e,"transfer"));return g.u4.all(K)}),3);
case 3:if(!C){R.cS(4);break}return g.l(R,wMk(U),4);case 4:npL({videoId:U,U3:e,offlineModeType:(m=d)==null?void 0:m.offlineModeType}),g.tz(R)}})},y6c=function(S,b,C,z){if(!S.action.entityKey)throw Error("entityKey is missing.");
var U=g.Lh(S.action.entityKey);U={entityType:U.wK,entityId:U.entityId,offlineOrchestrationActionType:S.action.actionType,orchestrationAction:{orchestrationActionId:S.actionId}};b&&(U.offlineOrchestrationActionResult=b.status,U.isRetryable=C?!1:b.J,b.Y&&(U.offlineOrchestrationFailureReason=J68(b.Y,U.isRetryable)));var a,J;if((a=S.action.actionMetadata)==null?0:(J=a.offlineLoggingData)==null?0:J.offlineModeType)U.offlineModeType=S.action.actionMetadata.offlineLoggingData.offlineModeType;z&&(U.additionalOrchestrationActions=
z.map(function(H){return{orchestrationActionId:H.actionId}}));
return U},J68=function(S,b){return S!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||b?S==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&b?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":S:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},HGx=function(S,b){var C={offlineOrchestrationContext:y6c(S)};
b=GU1(b,C);fVM(eTX(),b,S.rootActionId)},BbX=function(S,b,C,z){z=z===void 0?[]:z;
b={offlineOrchestrationContext:y6c(S,b,C,z)};b=GU1(3,b);fVM(eTX(),b,S.rootActionId)},s95=function(){this.actions=[]},xpl=function(S,b){b=g.t(b);
for(var C=b.next();!C.done;C=b.next())C=C.value,HGx(C,1),S.actions.push(C);S.actions.sort(S.J)},EgK=function(S,b){if(b)for(var C=0;C<S.actions.length;C++)if(b==="!*$_ALL_ENTITIES_!*$"&&S.actions[C].actionId!==b||b!=="!*$_ALL_ENTITIES_!*$"&&S.actions[C].rootActionId===b&&S.actions[C].actionId!==b)S.actions.splice(C,1),C--},dp2=function(S,b){S=g.t(S.actions);
for(var C=S.next();!C.done;C=S.next())if(C.value.actionId===b)return!0;return!1},cE=function(S,b,C,z,U){g.D.call(this);
var a=this;this.K=S;this.sG=b;this.YQ=C;this.T=z;this.JB=U;this.J=new s95;this.B=new g.hx;this.Y=new g.M8(function(){a.retry()});
this.X=NaN;this.D=!1;this.FF={VEQ:function(){return a.J},
Ns:function(){return a.B},
DQk:function(){return a.Y},
retry:function(){return a.retry()}};
g.n(this,this.Y);this.j=this.K.observe(this.kQ.bind(this))},TbU=function(S,b,C,z,U){var a;
return g.O(function(J){if(J.J==1)return a=new cE(S,b,C,z,U),g.l(J,pf5(a),2);F5m(a);return J.return(a)})},F5m=function(S){var b=S.J.actions[0];
return S.C?((b==null?void 0:b.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&S.C[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(S.D=!0),Promise.resolve()):Vs5(S)},Vs5=function(S){var b,C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m;
return g.O(function(R){switch(R.J){case 1:if(S.C)throw Error("Already processing an action");if(S.AB())return R.return();b=S.J.actions.shift();D1x(S.YQ,!b);if(b===void 0)return R.return();b.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&b.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&EgK(S.J,b.actionId);C="";b.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&b.rootActionId===b.actionId&&(C=b.actionId);z=[b];S.C=z;if(U=S.sG[b.entityType]){R.cS(2);break}S.C=
void 0;return g.l(R,Vs5(S),3);case 3:return R.return();case 2:a=g.t(z);for(J=a.next();!J.done;J=a.next())H=J.value,HGx(H,2);g.u2(R,4,5);return g.l(R,vEX(U,z.map(function(X){return X.action})),7);
case 7:B=R.K,x=g.t(z),E=x.next();case 8:if(E.done){R.cS(10);break}d=E.value;p=B.get(d.action);return g.l(R,Pn1(S,d,p),9);case 9:E=x.next();R.cS(8);break;case 10:EgK(S.J,C);case 5:g.R8(R);S.C=void 0;g.W2(R,6);break;case 4:return F=g.fN(R),zl("Orchestration error",F),g.u2(R,12),g.l(R,tsM(S,z),14);case 14:g.GV(R,5);break;case 12:T=g.fN(R);zl("Orchestration retry error",T);k=g.t(z);for(e=k.next();!e.done;e=k.next())m=e.value,m.retryScheduleIndex<3&&xpl(S.J,[m]);R.cS(5);break;case 6:return g.l(R,Vs5(S),
0)}})},Pn1=function(S,b,C){var z,U,a,J,H,B,x,E,d,p,F,T;
return g.O(function(k){switch(k.J){case 1:z=b.retryScheduleIndex+2===3;if(C.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){k.cS(2);break}if(C.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){k.cS(0);break}BbX(b,C,z);if(C.J&&b.retryScheduleIndex+1<3)return g.l(k,tsM(S,[b]),0);a=((U=C)==null?0:U.K)?C.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";J={entityKey:b.action.entityKey,failureReason:a};H=void 0;g.SH(S.JB)?H="mainVideoDownloadStateEntity":g.QG(S.JB)&&(H="musicTrackDownloadMetadataEntity");
if(!H||!C.downloadState){k.cS(7);break}B=g.Lh(b.action.entityKey).entityId;return g.l(k,xf(B,H,S.K,C.downloadState),7);case 7:UL(S.T,J);if(C.downloadState==="DOWNLOAD_STATE_FAILED"&&S.JB.L("html5_auto_retry_failed_pde_actions")){k.cS(0);break}zl("Orchestration result is not retryable, deleting action");return g.l(k,U1U(S.K,VT(b).key),0);case 2:x=void 0;try{x=(E=C.C)==null?void 0:E.map(function(e){return S.createAction(e,b)})}catch(e){return BbX(b,C,z),d={entityKey:b.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},UL(S.T,d),zl("Orchestration subactions creation error",e),k.return()}BbX(b,C,z,x);if(!x){k.cS(12);break}p=x.map(function(e){return VT(e)});
F=0;case 13:if(!(F<x.length)||S.D){k.cS(15);break}return g.l(k,Ih(S.K,{mode:"readwrite",He:!0},function(e){var m=[];m.push(IzK(e,p.slice(F,F+10),"offlineOrchestrationActionWrapperEntity"));return g.u4.all(m)}),16);
case 16:F+=10;k.cS(13);break;case 15:if(S.D)return S.D=!1,k.return();case 12:return T=VT(b),g.l(k,U1U(S.K,T.key),17);case 17:HGx(b,4),g.tz(k)}})},GPM=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F;
return g.O(function(T){C=[];z=Infinity;U=4E3;a=g.t(b);for(J=a.next();!J.done;J=a.next())H=J.value,B=Number(H.enqueueTimeSec),x=kP8(B),E=H.retryScheduleIndex,d=E!=null&&E>0,x>0&&d?(z=Math.min(z,B),U=Math.min(x,U)):C.push(H);isFinite(z)&&(!S.Y.isActive()||z<S.X)&&(S.X=z,S.Y.start(U));S.B.uD()||(p=C.length,C=C.filter(function(k){var e;k=((e=k.actionProto)==null?void 0:e.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!uAx.includes(k)}),F=C.length<p,!S.Y.isActive()&&F&&S.Y.start(1));
C.length>0&&eXc(S,C);return g.l(T,F5m(S),0)})},mp2=function(S){var b,C,z,U,a,J,H;
return g.O(function(B){if(B.J==1)return g.l(B,fsl(S),2);b=B.K;C=[];z=g.t(b);for(U=z.next();!U.done;U=z.next())a=U.value,J=g.Lh(a.key),H=J.entityId,dp2(S.J,H)||C.push(a);return g.l(B,GPM(S,C),0)})},kP8=function(S){S=S*1E3-Date.now();
return S>4E3?4E3:S},tsM=function(S,b){var C,z,U;
return g.O(function(a){C=g.t(b);for(z=C.next();!z.done;z=C.next()){U=z.value;var J=void 0,H=void 0,B=((H=U.action)==null?void 0:(J=H.actionMetadata)==null?void 0:J.retryScheduleIntervalsInSeconds)||[1,2,4];J=1;U.retryScheduleIndex<B.length&&(J=B[U.retryScheduleIndex]);U.J=J*1E3+Date.now();U.retryScheduleIndex++}return g.l(a,RX8(S,b),0)})},pf5=function(S){var b;
return g.O(function(C){if(C.J==1)return g.l(C,qV(S.K,"offlineOrchestrationActionWrapperEntity"),2);b=C.K;return g.l(C,GPM(S,b),0)})},eXc=function(S,b){b.length!==0&&b.forEach(function(C){C=Tl(C);
C.retryScheduleIndex<3&&xpl(S.J,[C])})},fsl=function(S,b){var C;
return g.O(function(z){if(z.J==1)return g.l(z,qV(S.K,"offlineOrchestrationActionWrapperEntity",b),2);C=z.K;return z.return(C.filter(sHX))})},RX8=function(S,b){if(b.length===0)return Promise.resolve([]);
b=b.map(function(C){return VT(C)});
return $15(S.K,b)},W51=function(S){this.HS=S;
this.J=void 0},lsx=function(S,b){var C,z,U,a;
return g.O(function(J){C=b.videoId;z=!0;if(b.captionTracks.length)U=MkM(b),S.J=new g.F_(S.HS,b,U);else if(b.uM)a=g.PON(b),S.J=new g.Vs(S.HS,b.uM,C,a,b.uu,b.eventId),z=b.uu;else return J.return();return J.return(new Promise(function(H){var B;(B=S.J)==null||B.Fm({kK:function(){return g.O(function(x){if(x.J==1)return g.l(x,S.kK(C,z),2);H();g.tz(x)})},
Ui:function(){}})}))})},j95=function(S){var b;
return g.O(function(C){if(C.J==1)return g.l(C,FaM(S),2);b=C.K;return C.return(!!b&&b.length>0)})},Dh=function(S){g.D.call(this);
this.J=S;this.K=this.J.observe(this.Y.bind(this))},Xfk=function(S,b){var C,z,U,a,J,H,B;
return g.O(function(x){switch(x.J){case 1:if(b.length===0)return x.return([]);C=b.map(function(E){return g.q2(E,"transfer")});
return g.l(x,qV(S.J,"transfer",C),2);case 2:z=x.K;U=z.filter(sHX).map(function(E){return g.Lh(E.key).entityId});
a=b.filter(function(E){return U.indexOf(E)===-1});
if(a.length===0)return x.return([]);J=g.t(a);H=J.next();case 3:if(H.done){x.cS(5);break}B=H.value;return g.l(x,wMk(B),4);case 4:H=J.next();x.cS(3);break;case 5:return x.return(a)}})},vgl=function(S,b,C,z,U,a){var J,H,B;
return g.O(function(x){J="STREAM_TYPE_UNKNOWN";C.video&&C.audio?(J="STREAM_TYPE_AUDIO_AND_VIDEO",zl("unexpected stream type")):C.video&&!C.audio?J="STREAM_TYPE_VIDEO":!C.video&&C.audio&&(J="STREAM_TYPE_AUDIO");H=g.q2(b,"offlineVideoStreams");B={numBytesDownloaded:U.toFixed(),numTotalBytes:a.toFixed(),streamType:J,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(z),itag:J==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(C.itag):void 0};return g.l(x,Ih(S,{mode:"readwrite",He:!0},
function(E){var d=ni(E,H,"offlineVideoStreams"),p=ni(E,g.q2(b,"transfer"),"transfer");return g.u4.all([d,p]).then(function(F){F=g.t(F);var T=F.next().value;F=F.next().value;if(!F)return rm(E,H).then(function(){});
var k=OG6(T);T=A62(T,z,B,H);var e=MV(E,T,"offlineVideoStreams");OG6(T)>k&&(F.lastProgressTimeMs=Date.now().toString());k=[e];F.offlineVideoStreams||(F.offlineVideoStreams=[]);F.offlineVideoStreams.indexOf(H)===-1&&(F.offlineVideoStreams.push(H),k.push(MV(E,F,"transfer")));return g.u4.all(k)})}),0)})},K5O=function(S,b){var C,z,U,a,J;
return g.O(function(H){if(H.J==1)return C=g.q2(b,"offlineVideoStreams"),g.l(H,Li(S,C,"offlineVideoStreams"),2);z=H.K;if(!z||!z.streamsProgress)return H.return();U=g.t(z.streamsProgress);for(a=U.next();!a.done;a=U.next())J=a.value,J.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",J.numTotalBytes!==J.numBytesDownloaded&&(J.numBytesDownloaded=J.numTotalBytes);return g.l(H,wm(S,z,"offlineVideoStreams"),0)})},A62=function(S,b,C,z){if(S&&S.streamsProgress){z=S;
a:{b=b.itag+";"+b.xtags;for(var U=S.streamsProgress,a=0;a<U.length;a++){var J=JSON.parse(U[a].formatStreamBytes);if(J.itag+";"+J.xtags===b){U[a]=C;C=U;break a}}U.push(C);C=U}z.streamsProgress=C}else S={key:z,streamsProgress:[C]};return S},OG6=function(S){if(S==null?0:S.streamsProgress){var b=0;
S=S.streamsProgress;for(var C=0;C<S.length;C++){var z=S[C];isNaN(Number(z.numBytesDownloaded))?zl("stream progress bytes number invalid"):b+=Number(z.numBytesDownloaded)}return b}return 0},Q9K=function(S,b,C,z){g.D.call(this);
var U=this;this.K=S;this.api=b;this.Ri=C;this.kQ=z;this.B=new g.hx;this.C=new g.M8(function(){U.J&&U.J.transferState==="TRANSFER_STATE_TRANSFERRING"&&U.B.uD()&&((U.J.transferRetryCount||0)<3?QT(U.T,U.D,!1,!1):KY(U.T,U.D.videoDetails.videoId),U.S_("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.YQ=this.zE=0;this.j=this.X=!1;this.TE=g.dQ(this.api.G().experiments,"html5_transfer_processing_logs_interval");this.De=new g.ny(this);this.FF={T_i:function(){return U.C},
IZE:function(){return U.kQ},
Ns:function(){return U.B}};
this.sG=this.K.observe(this.h6.bind(this));this.T=new I7L(b,this);this.GE=new W51(b);this.hB=new Dh(this.K);this.UG=this.B.listen("publicytnetworkstatus-online",this.CA.bind(this));this.BS=this.B.listen("publicytnetworkstatus-offline",this.OPQ.bind(this));this.j=this.api.G().L("html5_less_transfer_processing_logs");g.n(this,this.De);this.De.W(b,"offlinetransferpause",this.M6x);g.SH(this.api.G())?this.Y="mainVideoDownloadStateEntity":g.QG(this.api.G())&&(this.Y="musicTrackDownloadMetadataEntity")},
c6c=function(S){return g.O(function(b){if(b.J==1)b=g.l(b,d1L(),2);
else{var C=S.hB;var z=g.jH();z=Object.keys(z);C=Xfk(C,z);b=g.l(b,C,0)}return b})},nY=function(S,b){b=b===void 0?!1:b;
var C;return g.O(function(z){if(z.J==1){if(S.J)throw Error("Already downloading a video");S.YQ=0;S.X=!1;return g.l(z,DpK(S),2)}return z.J!=4?(C=z.K,NJm(S.Ri,!C),C&&S.B.uD()?b?g.l(z,new Promise(function(U){g.d_(U,1E3)}),4):z.cS(4):(!C&&S.J&&NK(S),z.cS(0))):g.l(z,NbK(S,C),0)})},ngX=function(S){return g.O(function(b){if(b.J==1)return S.D?g.l(b,KY(S.T,S.D.videoDetails.videoId),3):b.cS(0);
NK(S);g.tz(b)})},gg1=function(S,b){var C,z,U;
return g.O(function(a){switch(a.J){case 1:return g.u2(a,2),(C=!!b.captionTracks.length||!!b.uM)?g.l(a,j95(b.videoId),4):a.return();case 4:return(z=a.K)?a.return():g.l(a,lsx(S.GE,b),5);case 5:g.GV(a,0);break;case 2:U=g.fN(a),zl("Caption downloading error",U,b.cotn),g.tz(a)}})},NbK=function(S,b){var C,z,U,a,J,H;
return g.O(function(B){switch(B.J){case 1:if(S.X)return B.return();S.X=!0;S.J=b;C=g.Lh(S.J.key);z=C.entityId;U=void 0;if(S.J.transferState==="TRANSFER_STATE_TRANSFERRING")return g.l(B,gh(S,z),7);if(S.J.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||S.J.transferRetryCount||S.J.hasLoggedFirstStarted){B.cS(3);break}return g.l(B,gh(S,z),5);case 5:return U=B.K,S.J.hasLoggedFirstStarted=!0,g.l(B,Ypl(S),6);case 6:gpl({videoId:z,U3:S.J,offlineModeType:U},void 0,void 0,!0);B.cS(3);break;case 7:U=B.K,
Jy({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:z,U3:S.J,offlineModeType:U});case 3:return g.l(B,Ms5(S),8);case 8:return a=null,g.u2(B,9),g.l(B,r6l(S,b),11);case 11:a=B.K;S.D=a;g.GV(B,10);break;case 9:return J=g.fN(B),zl("error getting player response",J,b.cotn),g.l(B,S.S_("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return B.return();case 10:return H=w78(S.api.G(),b.cotn,a),g.l(B,gg1(S,H),13);case 13:return g.l(B,LZK(H.videoId),
14);case 14:H.sQ=B.K,CnU(S.T,H,b.maximumDownloadQuality),S.C.start(108E5),g.tz(B)}})},DpK=function(S){var b,C;
return g.O(function(z){if(z.J==1)return g.l(z,qV(S.K,"transfer"),2);b=z.K;C=b.filter(ZGc).sort(hXl);return C.length===0?z.return():z.return(C[0])})},Ms5=function(S){var b,C,z;
return g.O(function(U){if(U.J==1){if(!S.J)return Yf(S,"onTransferStart"),U.return();S.C.start(108E5);return g.l(U,MK(S,"TRANSFER_STATE_TRANSFERRING"),2)}b=S.J;return(z=((C=b)==null?0:C.key)?g.Lh(b.key).entityId:"")&&S.Y?g.l(U,xf(z,S.Y,S.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):U.cS(0)})},Sp2=function(S){var b,C,z,U;
g.O(function(a){switch(a.J){case 1:if(!S.J){Yf(S,"onTransferPausedByUser");a.cS(2);break}b=S.J;S.C.stop();return g.l(a,MK(S,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:z=((C=b)==null?0:C.key)?g.Lh(b.key).entityId:"";if(!z||!S.Y){a.cS(4);break}return g.l(a,xf(z,S.Y,S.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.l(a,gh(S,z),6);case 6:U=a.K,MqM({videoId:z,U3:b,offlineModeType:U});case 2:NK(S),nY(S),g.tz(a)}})},bG5=function(S){var b,C,z;
g.O(function(U){if(U.J==1){if(!S.J)return Yf(S,"onTransferPausedByNetwork"),U.return();S.C.stop();return g.l(U,MK(S,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(U.J!=3)return b=S.J,(z=((C=b)==null?0:C.key)?g.Lh(b.key).entityId:"")&&S.Y?g.l(U,xf(z,S.Y,S.K,"DOWNLOAD_STATE_PAUSED"),3):U.cS(3);NK(S);g.tz(U)})},Is8=function(S){var b,C,z,U,a;
g.O(function(J){switch(J.J){case 1:if(!S.J)return Yf(S,"onTransferComplete"),J.return();b=S.J;S.C.stop();if(!b||!S.D){J.cS(2);break}C=w78(S.api.G(),b.cotn,S.D);return g.l(J,gg1(S,C),2);case 2:return g.l(J,MK(S,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:U=((z=b)==null?0:z.key)?g.Lh(b.key).entityId:"";if(!U||!S.Y){J.cS(5);break}return g.l(J,xf(U,S.Y,S.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.l(J,K5O(S.K,U),7);case 7:return g.l(J,gh(S,U),8);case 8:a=J.K,Jy({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:U,U3:b,offlineModeType:a}),NK(S),nY(S),g.tz(J)}})},wfL=function(S,b,C){var z,U;
g.O(function(a){switch(a.J){case 1:if(!S.J)return Yf(S,"onTransferProgress: "+b),a.return();if(S.J.transferState==="TRANSFER_STATE_TRANSFERRING"){a.cS(2);break}return g.l(a,Ms5(S),2);case 2:z=Date.now();if(!(z-S.zE>1E3)){a.cS(4);break}S.zE=z;return g.l(a,vgl(S.K,C.videoId,C.K,C.h4,C.bytesDownloaded,C.J),5);case 5:if(S.j&&!(S.j&&z-S.YQ>S.TE)){a.cS(4);break}S.YQ=z;return g.l(a,gh(S,b),7);case 7:U=a.K,gpl({videoId:b,U3:S.J,offlineModeType:U},C.bytesDownloaded,C.J);case 4:S.C.start(108E5),g.tz(a)}})},
L5k=function(S){var b=(S.J.transferRetryCount||0)<3;
b&&(S=S.J,S.transferRetryCount=(S.transferRetryCount||0)+1);return b},qp5=function(S,b){b=b===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":b;
var C,z,U,a;return g.O(function(J){if(J.J==1)return S.J||Yf(S,"setTransferToFailed: "+b),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b==="TRANSFER_FAILURE_REASON_NETWORK"?C="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":b==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.l(J,MK(S,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",b),2);if(J.J!=3)return UL(S.kQ,{entityKey:(z=S.J)==null?void 0:z.key,failureReason:C}),
U=S.J?g.Lh(S.J.key).entityId:"",g.l(J,gh(S,U),3);a=J.K;var H={videoId:U,U3:S.J,offlineModeType:a},B=b,x={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};B&&(x.transferFailureReason=B,x.failureReason=rtO(B));Jy(x,H);g.tz(J)})},MK=function(S,b,C,z){var U;
return g.O(function(a){if(a.J==1){if(!S.J)return Yf(S,"saveTransferState: "+b),a.return();S.J.transferState=b;S.J.failureReason=z;g.u2(a,2);return g.l(a,Ypl(S,function(J){return C?gm(J,"offlineVideoStreams",S.J.offlineVideoStreams).then(function(H){for(var B=g.t(H),x=B.next();!x.done;x=B.next())if((x=x.value)&&x.streamsProgress){x=g.t(x.streamsProgress);for(var E=x.next();!E.done;E=x.next())E.value.streamState=C}return IzK(J,H.filter(function(d){return!!d}),"offlineVideoStreams")}):g.u4.resolve(void 0)}),
4)}if(a.J!=2)return g.GV(a,0);
U=g.fN(a);return U instanceof g.p5&&U.type==="QUOTA_EXCEEDED"?g.l(a,S.S_("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):a.cS(0)})},Ypl=function(S,b){var C;
return g.O(function(z){if(!S.J)return z.return();C=S.J;return g.l(z,Ih(S.K,{mode:"readwrite",He:!0},function(U){var a=[MV(U,C,"transfer")];b&&a.push(b(U));return g.u4.all(a)}),0)})},NK=function(S){S.J=void 0;
S.D=void 0;S.C.stop()},r6l=function(S,b){var C,z,U,a,J;
return g.O(function(H){if(H.J==1)return C=g.Lh(b.key),z=C.entityId,U=g.q2(z,"playbackData"),g.l(H,Li(S.K,U,"playbackData"),2);a=H.K;if((J=a)==null?0:J.playerResponseJson)return H.return(JSON.parse(a.playerResponseJson));throw Error("No PlayerResponse found");})},Yf=function(S,b){S.api.Kx("woffle",{mcte:b});
zl("missing current transfer entity.")},gh=function(S,b){var C,z,U;
return g.O(function(a){if(a.J==1)return g.l(a,Li(S.K,g.q2(b,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);C=a.K;return a.return((U=(z=C)==null?void 0:z.offlineModeType)!=null?U:void 0)})},ZGc=function(S){return SBL[S.transferState]!==void 0},hXl=function(S,b){var C=SBL[S.transferState],z=SBL[b.transferState];
return C!==z?C-z:Number(S.enqueuedTimestampMs)-Number(b.enqueuedTimestampMs)},rh=function(S,b){var C=this;
this.JB=S;this.api=b;this.B=new g.hx;this.D=new g.H7;this.FF={Gm:function(){return C.Y.FF.Gm()},
Ns:function(){return C.B},
o2R:function(){return C.Y},
uY:function(){return C.uY()},
GX:function(){return C.GX()},
xA:function(){return C.xA()},
YA:function(){return C.YA()},
JG:function(){return C.JG()},
qY:function(z){return C.qY(z)}};
this.Y=new KaL(function(){return bQU(C)},function(){C.xA()},this.api.xK(),this.api.L.bind(this.api));
this.J=new $f(this.api);QHX(this.Y)},bQU=function(S){return g.O(function(b){S.api.xQ("onOrchestrationBecameLeader");
return g.l(b,S.GX(),0)})},iQL=function(S){var b,C;
return g.O(function(z){if(z.J==1)return g.l(z,SF(),2);if(z.J!=3){b=z.K;if(!b)return zl("PES is undefined"),z.return();S.K=new Q9K(b,S.api,S.Y,S.J);C=S.OF(b);return g.l(z,TbU(b,C,S.Y,S.J,S.JB),3)}S.T=z.K;return g.l(z,CD8(S),0)})},CD8=function(S){var b;
return g.O(function(C){switch(C.J){case 1:if(!S.K)return zl("transferManager is undefined"),C.return();if(S.K.J){C.cS(2);break}return g.l(C,nY(S.K),2);case 2:if(!S.JB.L("woffle_enable_main_downloads_library")){C.cS(4);break}return g.l(C,S.Mz(),4);case 4:if(!S.JB.L("html5_offline_playback_position_sync")){C.cS(6);break}return g.l(C,S.fv(),7);case 7:return g.l(C,S.qY(864E5),6);case 6:return g.l(C,S.refreshAllStaleEntities(43200,!0),9);case 9:return g.l(C,S.oE(),10);case 10:if(!S.JB.L("html5_retry_downloads_for_expiration")){C.cS(11);
break}return g.l(C,S.JG(),11);case 11:return S.X=g.pp(function(){S.refreshAllStaleEntities(43200,!0);S.oE()},9E5),g.qB(g.b4(),function(){return S.YA()}),g.l(C,SF(),13);
case 13:return b=C.K,g.l(C,vp2(b),14);case 14:ctc(S.Y),g.tz(C)}})},zvL=function(){var S,b,C,z,U,a;
return g.O(function(J){switch(J.J){case 1:return g.l(J,SF(),2);case 2:S=J.K;if(!S)return J.return([]);b=Date.now()/1E3;return g.l(J,qV(S,"offlineVideoPolicy"),3);case 3:C=J.K,z=g.t(C),U=z.next();case 4:if(U.done){J.cS(6);break}a=U.value;if(!(a.expirationTimestamp&&Number(a.expirationTimestamp)<b)){J.cS(5);break}a.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";a.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.l(J,wm(S,a,"offlineVideoPolicy"),5);
case 5:U=z.next();J.cS(4);break;case 6:return J.return(C.map(function(H){return H.key}))}})},Zh=function(S,b,C,z,U){var a,J,H;
return g.O(function(B){if(B.J==1)return g.l(B,SF(),2);a=B.K;if(!a)return B.return([]);J=b.map(function(x){var E=g.q2(x,C);E={actionType:z,entityKey:E,actionMetadata:Object.assign({},La6(),U)};z!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(E.actionMetadata.priority=0);x=new FU(C,x,E);return VT(x)});
H=$15(a,J);QHX(S.Y);return B.return(H)})},$w2=function(S,b,C,z){var U,a,J,H,B,x,E,d;
return g.O(function(p){switch(p.J){case 1:U=[],a=g.t(b),J=a.next();case 2:if(J.done){p.cS(4);break}H=J.value;if(H.upToDate||C&&!H.shouldAutoSyncMetadata||!H.playlistId){p.cS(3);break}B={};switch(z){case "mainPlaylistEntity":x={nextAutoRefreshIntervalSeconds:H.checkInSeconds,autoSync:C};B={mainPlaylistEntityActionMetadata:x};break;case "musicPlaylist":E={autoSync:C},B={musicPlaylistEntityActionMetadata:E}}return g.l(p,Zh(S,[H.playlistId],z,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B),6);case 6:(d=
p.K)&&U.push.apply(U,g.u(d));case 3:J=a.next();p.cS(2);break;case 4:return p.return(U)}})},UwK=function(S,b){var C;
return g.O(function(z){return b.length?(C=La6(),g.Nm(C,Ay,{isEnqueuedForExpiredStreamUrlRefetch:!0}),S.api.Kx("qrd",{v:b.length}),z.return(Zh(S,b,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C))):z.return([])})},aC2=function(S,b,C){this.J=S;
this.JB=b;this.Y=C},yk8=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R;
return g.O(function(X){switch(X.J){case 1:return C=yT(b),z=g.Lh(b.entityKey),U=z.entityId,a=[],g.u2(X,2),g.l(X,oex(S,U),4);case 4:a=X.K;if(!(S.JB.L("woffle_enable_main_downloads_library")&&((J=a)==null?0:J.length))){X.cS(5);break}return g.l(X,HHK(S.J,[b.entityKey]),5);case 5:g.GV(X,3);break;case 2:return H=g.fN(X),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.p5&&H.type==="QUOTA_EXCEEDED"?(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):zl("Playlist add error"),X.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,B,x));case 3:E=[];if(!S.JB.L("html5_offline_prevent_redownload_downloaded_video")){X.cS(7);break}return g.l(X,IVl(S.J,"mainVideoEntity",a),8);case 8:a=X.K;case 7:if((d=a)==null?0:d.length)for(p=g.t(a),F=p.next();!F.done;F=p.next())if(T=F.value,k=T.offlineVideoData,e=void 0,(e=k)==null?0:e.videoId)m=void 0,R=Number(((m=b.actionMetadata)==null?void 0:m.priority)||
0)+1,E.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k.videoId,"mainVideoEntity",R,hy,Jk5(b,k,U)));return X.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,E))}})},Bek=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8,mR,b6,o5,FX,G,f,W,A,v,CN,UH,o8,Q,km,Jz,yX,OH,wM,D1,w8,rM,h3,Dg,dq,MG,sc,hO,NN,Ix,e_,x1,je,p9,X5,nb,gj,f$,bV,ws,U0,RL,Mw;
return g.O(function(da){switch(da.J){case 1:return C=yT(b),z=b.entityKey,U=g.Lh(z).entityId,a=[],J=!1,U==="!*$_ALL_ENTITIES_!*$"?(J=!0,g.l(da,qV(S.J,"mainPlaylistEntity"),5)):g.l(da,Li(S.J,z,"mainPlaylistEntity"),4);case 4:(H=da.K)&&a.push(H);da.cS(3);break;case 5:a=da.K;case 3:if((B=a)==null||!B.length)return da.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));x=g.M(b.actionMetadata,HQl);d=(E=x)==null?void 0:E.nextAutoRefreshIntervalSeconds;F=(p=x)==null?void 0:p.autoSync;T=[];e=k=
!0;m=!1;if(!J&&F===!1){da.cS(6);break}g.u2(da,7);return g.l(da,e15(0,!!F,!0,a),9);case 9:T=da.K;g.GV(da,8);break;case 7:R=g.fN(da);if(!(R instanceof Error&&R.message==="No data")){R instanceof Error&&R.message==="Empty response body"&&zl(R.message);da.cS(8);break}return U==="!*$_ALL_ENTITIES_!*$"?g.l(da,$86(S.J,b,S.Y,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.l(da,iHm(U,S.J,b,S.Y),8);case 8:if(!T.length||!J&&T[0].playlistId!==U)return da.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C));case 6:if(J){X=[];K=g.t(T);for(N=K.next();!N.done;N=K.next())b2=N.value,b2.upToDate||F&&!b2.shouldAutoSyncMetadata||!b2.playlistId||(I={nextAutoRefreshIntervalSeconds:b2.checkInSeconds,autoSync:F},X.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b2.playlistId,"mainPlaylistEntity",0,hy,{mainPlaylistEntityActionMetadata:I})));return da.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,X))}T.length&&($m=T[0],m=!!$m.upToDate,F&&(k=(a8=$m.shouldAutoSyncMetadata)!=null?a8:!0,e=(S0=
$m.shouldAutoSyncVideos)!=null?S0:!0,$m.checkInSeconds&&(d=$m.checkInSeconds)));if(m||!k)return da.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));Y=[];q=a[0];if(!q.downloadState){P=void 0;da.cS(15);break}return g.l(da,Li(S.J,q.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:P=da.K;case 15:return r=P,u6=((QX=r)==null?0:QX.addedTimestampMillis)?String(r.addedTimestampMillis):void 0,g.u2(da,17),g.l(da,oex(S,U,u6,d),19);case 19:Y=da.K;g.GV(da,18);break;case 17:d8=g.fN(da);
if(!(d8 instanceof Error&&d8.message==="No data for playlist")){if(d8 instanceof Error&&d8.message==="Empty response body for playlist")zl(d8.message);else return mR="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b6="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d8 instanceof g.p5&&d8.type==="QUOTA_EXCEEDED"&&(mR="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b6="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),da.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
C,void 0,mR,b6));da.cS(18);break}return g.l(da,iHm(U,S.J,b,S.Y),18);case 18:if(!e)return da.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));o5=[];FX=new Map;if((G=Y)==null?0:G.length)for(f=g.t(Y),W=f.next();!W.done;W=f.next())A=W.value,v=A.offlineVideoData,CN=void 0,((CN=v)==null?0:CN.videoId)&&FX.set(v.videoId,v);UH=new Map;o8=[];if((Q=q)==null?0:(km=Q.videos)==null?0:km.length)for(Jz=g.t(q.videos),yX=Jz.next();!yX.done;yX=Jz.next())if(OH=yX.value,wM=JSON.parse(g.Lh(OH).entityId),
D1=wM.videoId)FX.has(D1)?(UH.set(D1,FX.get(D1)),FX.delete(D1)):o8.push(D1);rM=Number(((w8=b.actionMetadata)==null?void 0:w8.priority)||0)+1;h3=g.t(FX.entries());for(Dg=h3.next();!Dg.done;Dg=h3.next())dq=Dg.value,MG=g.t(dq),sc=MG.next().value,hO=MG.next().value,NN=sc,Ix=hO,o5.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",NN,"mainVideoEntity",rM,hy,Jk5(b,Ix,U)));e_=g.t(UH.entries());for(x1=e_.next();!x1.done;x1=e_.next())je=x1.value,p9=g.t(je),X5=p9.next().value,nb=p9.next().value,gj=X5,f$=nb,o5.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
gj,"mainVideoEntity",rM,hy,Jk5(b,f$,U)));bV=g.t(o8);for(ws=bV.next();!ws.done;ws=bV.next())U0=ws.value,RL={playlistId:U},Mw={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:RL},o5.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",U0,"mainVideoEntity",0,hy,Mw));return da.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,o5))}})},sgl=function(S,b){var C,z,U,a;
return g.O(function(J){switch(J.J){case 1:return C=yT(b),g.u2(J,2),z=g.Lh(b.entityKey).entityId,z==="!*$_ALL_ENTITIES_!*$"?g.l(J,$86(S.J,b,S.Y,(U=b.actionMetadata)==null?void 0:(a=U.offlineLoggingData)==null?void 0:a.offlineDeleteReason),5):g.l(J,iHm(z,S.J,b,S.Y),6);case 6:if(!S.JB.L("woffle_enable_main_downloads_library")){J.cS(5);break}return g.l(J,BK5(S.J,b.entityKey),5);case 5:g.GV(J,3);break;case 2:return g.fN(J),J.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},oex=function(S,b,C,z){var U,a,J,H,B,x,E;
return g.O(function(d){switch(d.J){case 1:return g.l(d,kW1([b]),2);case 2:return U=d.K,g.l(d,xwL(S,U[0],C,z),3);case 3:return a=d.K,J=a.mainPlaylistEntity,H=a.k_B,x=bHm(J,(B=H)==null?void 0:B.avatar),g.u2(d,4),g.l(d,ty(x),6);case 6:g.GV(d,5);break;case 4:E=g.fN(d),E instanceof Error&&E.message==="Failed to fetch"&&zl(E.message);case 5:return d.return(U[0].videos)}})},xwL=function(S,b,C,z){var U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K;
return g.O(function(N){switch(N.J){case 1:U=Date.now().toString();C||(C=U);a=b.videos;J=b.playlistId;H=[];B=[];if(a)for(x=g.t(a),E=x.next();!E.done;E=x.next()){d=E.value;p=d.offlineVideoData;if(!p||!p.videoId)throw zl("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");F=p.videoId;T={videoId:F,playlistId:J};k={id:g.q2(JSON.stringify(T),"mainPlaylistVideoEntity"),video:g.q2(F,"mainVideoEntity")};H.push(k);B.push(k.id)}m={key:g.q2(J,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:C,lastSyncedTimestampMillis:U};R={key:g.q2(J,"mainPlaylistEntity"),playlistId:J,videos:B,title:b.title,thumbnailStyleData:Eem(b),visibility:dwx(b),downloadState:m.key};b.channel&&(X=b.channel.offlineChannelData,e=p$O(g.q2(J,"ytMainChannelEntity"),X),R.channelOwner=e.id);((K=R)==null?0:K.entityMetadata)?(R.entityMetadata.offlineLastModifiedTimestampSeconds=b.lastModifiedTimestamp,z&&(R.entityMetadata.nextAutoRefreshIntervalSeconds=String(z))):R&&(R.entityMetadata={nextAutoRefreshIntervalSeconds:z?
String(z):void 0,offlineLastModifiedTimestampSeconds:b.lastModifiedTimestamp});g.u2(N,2);return g.l(N,Ih(S.J,{mode:"readwrite",He:!0},function(b2){var I=MV(b2,R,"mainPlaylistEntity"),$m=MV(b2,m,"mainPlaylistDownloadStateEntity");I=[I,$m];$m=g.t(H);for(var a8=$m.next();!a8.done;a8=$m.next())I.push(MV(b2,a8.value,"mainPlaylistVideoEntity"));e&&I.push(MV(b2,e,"ytMainChannelEntity"));return g.u4.all(I)}),4);
case 4:g.GV(N,3);break;case 2:throw g.fN(N),zl("PES failure for playlist"),Error("PES failure for playlist");case 3:return N.return({mainPlaylistEntity:R,k_B:e,HiG:H})}})},p$O=function(S,b){return{id:S,
channelId:b.channelId,title:b.title,avatar:b.thumbnail}},Eem=function(S){var b=[],C=S.videos;
C&&C.length>0&&b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:C[0].offlineVideoData.thumbnail}}});if((S=S.additionalMetadadatas)&&S.length>0)for(S=g.t(S),C=S.next();!C.done;C=S.next()){var z=C.value.offlineBundleItemPlaylistData,U=void 0;C=(U=z)==null?void 0:U.style;U=void 0;z={collageThumbnail:{coverThumbnail:(U=z)==null?void 0:U.coverThumbnail}};switch(C){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:z});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:z});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:z});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:z})}}return b},dwx=function(S){switch(S.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Jk5=function(S,b,C){b={offlineVideoData:b,
playlistId:C};if(S=g.M(S.actionMetadata,HQl))b.maximumDownloadQuality=S.maximumDownloadQuality;return{mainVideoEntityActionMetadata:b}},Ff5=function(S,b,C){this.J=S;
this.JB=b;this.Y=C},PDU=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T;
return g.O(function(k){switch(k.J){case 1:return C=yT(b),z=g.Lh(b.entityKey),U=z.entityId,a=g.M(b.actionMetadata,Ia),H=!((J=a)==null?0:J.playlistId),g.u2(k,2),g.l(k,TeK(S,U,void 0,(B=a)==null?void 0:B.offlineVideoData,H),4);case 4:g.GV(k,3);break;case 2:return x=g.fN(k),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.p5&&x.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
k.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,E,d));case 3:p=1;p=Number(((F=b.actionMetadata)==null?void 0:F.priority)||0)+1;var e=(e=g.M(b.actionMetadata,Ia))?{playbackDataActionMetadata:{maximumDownloadQuality:e.maximumDownloadQuality}}:void 0;T=XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U,"playbackData",p,V1O,e);return k.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,[T]))}})},t1O=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R;
return g.O(function(X){switch(X.J){case 1:return C=yT(b),z=g.Lh(b.entityKey),U=z.entityId,g.l(X,Li(S.J,b.entityKey,"mainVideoEntity"),2);case 2:a=X.K;if(!a){J=void 0;X.cS(3);break}return g.l(X,Li(S.J,a.downloadState,"mainVideoDownloadStateEntity"),4);case 4:J=X.K;case 3:H=J;if(!a||!H)return X.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));g.u2(X,5);return g.l(X,TeK(S,U,H.addedTimestampMillis,(x=g.M(b.actionMetadata,Ia))==null?void 0:x.offlineVideoData),7);case 7:E=1;E=Number(((d=
b.actionMetadata)==null?void 0:d.priority)||0)+1;B=XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U,"playbackData",E,V1O);g.GV(X,6);break;case 5:p=g.fN(X);if(!(p instanceof Error&&p.message==="No data")){if(p instanceof Error&&p.message==="Empty response body")zl(p.message);else return F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.p5&&p.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),X.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,F,T));X.cS(6);break}return g.l(X,eF(S.J,U),9);case 9:k=X.K;e=g.M(b.actionMetadata,Ia);if(R=(m=e)==null?void 0:m.playlistId)k.playlistId=R;k.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.l(X,kf(U,S.J,b,S.Y,k),6);case 6:return X.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,B?[B]:void 0))}})},k6l=function(S,b){var C,z,U,a,J,H,B,x,E,d;
return g.O(function(p){switch(p.J){case 1:return C=yT(b),g.u2(p,2),z=g.Lh(b.entityKey).entityId,z==="!*$_ALL_ENTITIES_!*$"?g.l(p,$86(S.J,b,S.Y,(E=b.actionMetadata)==null?void 0:(d=E.offlineLoggingData)==null?void 0:d.offlineDeleteReason),5):g.l(p,eF(S.J,z),6);case 6:U=p.K;a=g.M(b.actionMetadata,Ia);if(H=(J=a)==null?void 0:J.playlistId)U.playlistId=H;U.offlineDeleteReason=(B=b.actionMetadata)==null?void 0:(x=B.offlineLoggingData)==null?void 0:x.offlineDeleteReason;return g.l(p,kf(z,S.J,b,S.Y,U),7);
case 7:if(!S.JB.L("woffle_enable_main_downloads_library")){p.cS(5);break}return g.l(p,BK5(S.J,b.entityKey),5);case 5:g.GV(p,3);break;case 2:return g.fN(p),p.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C))}})},TeK=function(S,b,C,z,U){var a,J,H,B,x,E;
return g.O(function(d){switch(d.J){case 1:if(a=z){d.cS(2);break}return g.l(d,tr5([b]),3);case 3:J=d.K,a=J[0];case 2:return g.l(d,uZK(S,a,C,U),4);case 4:H=d.K;B=H.mainVideoEntity;x=H.channelEntity;g.u2(d,5);var p=pY(B.thumbnail),F=pY(x.avatar);return g.l(d,ty(p.concat(F)),7);case 7:g.GV(d,0);break;case 5:E=g.fN(d),E instanceof Error&&E.message==="Failed to fetch"&&zl(E.message),g.tz(d)}})},uZK=function(S,b,C,z){var U,a,J,H,B,x,E,d,p,F,T,k,e;
return g.O(function(m){switch(m.J){case 1:C||(C=Date.now().toString());a=(U=b.channel)==null?void 0:U.offlineChannelData;J={id:g.q2(b.videoId,"ytMainChannelEntity"),channelId:a.channelId,title:a.title,avatar:a.thumbnail};H={key:g.q2(b.videoId,"mainVideoDownloadStateEntity"),playbackData:g.q2(b.videoId,"playbackData"),addedTimestampMillis:C,videoDownloadContextEntity:g.q2(b.videoId,"videoDownloadContextEntity")};B={key:g.q2(b.videoId,"videoPlaybackPositionEntity"),videoId:b.videoId,lastPlaybackPositionSeconds:"0"};
S.JB.L("html5_offline_playback_position_sync")&&(x={playbackPosition:B.key});E=g.q2(b.videoId,"mainVideoEntity");d={key:E,videoId:b.videoId,title:b.title,thumbnail:b.thumbnail,localizedStrings:{viewCount:b.shortViewCountText},userState:x,lengthSeconds:b.lengthSeconds?Number(b.lengthSeconds):void 0,publishedTimestampMillis:b.publishedTimestamp?(Number(b.publishedTimestamp)*1E3).toString():void 0,formattedDescription:b.description,owner:J.id,downloadState:H.key};if(!S.JB.L("woffle_enable_main_downloads_library")||
!z){m.cS(2);break}return g.l(m,ybl(S.J,[E]),3);case 3:if(T=m.K)p=T.mainDownloadsLibraryEntity,F=T.mainDownloadsListEntity;case 2:return e=hTk,k={key:g.q2(b.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Nm(H,e,k),g.l(m,Ih(S.J,{mode:"readwrite",He:!0},function(R){var X=MV(R,J,"ytMainChannelEntity"),K=MV(R,H,"mainVideoDownloadStateEntity"),N=MV(R,d,"mainVideoEntity");X=[X,K,N];S.JB.L("html5_offline_playback_position_sync")&&(K=MV(R,B,"videoPlaybackPositionEntity"),
X.push(K));p&&(K=MV(R,p,"mainDownloadsLibraryEntity"),X.push(K));F&&(K=MV(R,F,"mainDownloadsListEntity"),X.push(K));k&&(R=MV(R,k,"downloadStatusEntity"),X.push(R));return g.u4.all(X)}),4);
case 4:return m.return({mainVideoEntity:d,channelEntity:J})}})},evx=function(S,b,C){this.J=S;
this.JB=b;this.Y=C},fCl=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q;
return g.O(function(P){switch(P.J){case 1:return C=yT(b),z=[],g.l(P,ce.getInstance(),2);case 2:U=P.K;if(!U){P.cS(3);break}return g.l(P,U.get("sdois"),4);case 4:return a=P.K,g.l(P,(H=U)==null?void 0:H.get("lmqf"),5);case 5:J=P.K;case 3:g.u2(P,6);if(a===void 0)throw Error("prefStorage or opt-in state is undefined");B=[];if(a){P.cS(8);break}return g.l(P,Jb6(S.J),9);case 9:B=P.K,B.reverse();case 8:if(!B.length){P.cS(10);break}x=g.t(B);E=x.next();case 11:if(E.done){P.cS(10);break}d=E.value;if(!d){P.cS(12);
break}p=g.Lh(d).entityId;return g.l(P,eF(S.J,p),14);case 14:return F=P.K,F.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.l(P,kf(p,S.J,{entityKey:d,actionType:b.actionType},S.Y,F),12);case 12:E=x.next();P.cS(11);break;case 10:return g.l(P,f76(a,(T=J)!=null?T:"SD"),16);case 16:return k=P.K,g.l(P,U8c(k),17);case 17:e=oEm(k);if(!S.JB.L("woffle_enable_main_downloads_library")){P.cS(18);break}if(a){P.cS(19);break}return g.l(P,BK5(S.J,g.XO),19);case 19:return g.l(P,HHK(S.J,[g.XO]),18);
case 18:if((m=e)==null?0:m.length)for(R=g.t(e),X=R.next();!X.done;X=R.next())if(N=K=X.value,b2=N.actionType,I=N.entityKey,$m=N.actionMetadata,b2&&I&&$m&&!g.M($m,G6L)){b2==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&($m.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(a8=g.M(K.actionMetadata,Ia))a8.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",K.actionMetadata=Object.assign({},K.actionMetadata,{mainVideoEntityActionMetadata:a8});z.push(K)}g.GV(P,7);break;
case 6:return S0=g.fN(P),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S0 instanceof g.p5&&S0.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,Y,q));case 7:return P.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,z))}})},mw8=function(){rh.apply(this,arguments);
this.j="mainVideoEntity"},Rvc=function(S,b,C){b=b===void 0?43200:b;
C=C===void 0?!0:C;var z=z===void 0?!1:z;var U,a,J;return g.O(function(H){switch(H.J){case 1:if(!S.B.uD())return H.return([]);U=[];g.u2(H,2);return g.l(H,e15(b,C,z),4);case 4:U=H.K;g.GV(H,3);break;case 2:a=g.fN(H),a instanceof Error&&a.message==="No data"||a instanceof Error&&a.message==="Empty response body"&&zl(a.message);case 3:return J=$w2(S,U,C,"mainPlaylistEntity"),H.return(J)}})},Wfk=function(S,b,C,z){z=z===void 0?!1:z;
var U,a,J,H,B,x,E,d,p,F,T,k,e,m,R;return g.O(function(X){switch(X.J){case 1:return U=[],g.l(X,GWK(),2);case 2:return(a=X.K)||z?g.l(X,m8x(b,C),3):X.return([]);case 3:J=X.K;if((H=J)==null||!H.length)return X.return([]);B={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};x=g.t(J);E=x.next();case 4:if(E.done){X.cS(6);break}p=d=E.value;F=p.actionType;T=p.entityKey;k=p.actionMetadata;if(!(F&&T&&k)||g.M(k,G6L)){X.cS(5);break}F==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(k.offlineLoggingData=
B);e=g.Lh(T);m=e.entityId;return g.l(X,Zh(S,[m],"mainVideoEntity",F,k),8);case 8:R=X.K,U=U.concat(R);case 5:E=x.next();X.cS(4);break;case 6:return X.return(U)}})},lCO=function(S,b){this.J=S;
this.Y=b},X$L=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m;
return g.O(function(R){switch(R.J){case 1:return C=yT(b),z=g.Lh(b.entityKey),U=z.entityId,a=[],g.u2(R,2),g.l(R,jgX(S,U),4);case 4:a=R.K;if((J=a)==null||!J.length){R.cS(5);break}return g.l(R,pM6(S.J,b.entityKey),5);case 5:g.GV(R,3);break;case 2:return H=g.fN(R),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.p5&&H.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
R.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,B,x));case 3:return E=[],g.l(R,IVl(S.J,"musicTrack",a),7);case 7:a=R.K;if(a.length)for(d=g.t(a),p=d.next();!p.done;p=d.next())if(F=p.value,T=F.offlineVideoData,k=void 0,(k=T)==null?0:k.videoId)e=void 0,m=Number(((e=b.actionMetadata)==null?void 0:e.priority)||0)+1,E.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",m,wh,Ra(b,T,U)));return R.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,E))}})},
OQ5=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8,mR,b6,o5,FX,G,f,W,A,v,CN,UH,o8,Q,km,Jz,yX,OH,wM,D1,w8,rM,h3,Dg,dq,MG,sc,hO;
return g.O(function(NN){switch(NN.J){case 1:return C=yT(b),z=b.entityKey,U=g.Lh(z).entityId,a=[],J=!1,U==="!*$_ALL_ENTITIES_!*$"?(J=!0,g.l(NN,qV(S.J,"musicAlbumRelease"),5)):g.l(NN,Li(S.J,z,"musicAlbumRelease"),4);case 4:(H=NN.K)&&a.push(H);NN.cS(3);break;case 5:a=NN.K;case 3:if((B=a)==null||!B.length)return NN.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));if(J){x=[];E=g.t(a);for(d=E.next();!d.done;d=E.next())p=d.value,F=g.Lh(p.id).entityId,x.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
F,"musicAlbumRelease",0,wh));return NN.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,x))}T=[];k=a[0];e=void 0;if(!k.downloadMetadata){NN.cS(6);break}return g.l(NN,Li(S.J,k.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:m=NN.K,e=Number((X=(R=m)==null?void 0:R.addedTimestampMillis)!=null?X:"0")/1E3;case 6:return g.u2(NN,8),g.l(NN,jgX(S,U,(K=e)==null?void 0:K.toString()),10);case 10:T=NN.K;g.GV(NN,9);break;case 8:N=g.fN(NN);if(!(N instanceof Error&&N.message===
"No data")){if(N instanceof Error&&N.message==="Empty response body")zl(N.message);else return b2="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.p5&&N.type==="QUOTA_EXCEEDED"&&(b2="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),NN.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,b2,I));NN.cS(9);break}return g.l(NN,fY(U,"musicAlbumRelease",
S.J,b,S.Y),9);case 9:$m=[];a8=new Map;if((S0=T)==null?0:S0.length)for(Y=g.t(T),q=Y.next();!q.done;q=Y.next())P=q.value,r=P.offlineVideoData,QX=void 0,((QX=r)==null?0:QX.videoId)&&a8.set(r.videoId,r);u6=new Map;d8=[];if((mR=k)==null?0:(b6=mR.tracks)==null?0:b6.length)for(o5=g.t(k.tracks),FX=o5.next();!FX.done;FX=o5.next())if(G=FX.value,f=g.Lh(G).entityId)a8.has(f)?(u6.set(f,a8.get(f)),a8.delete(f)):d8.push(f);A=Number(((W=b.actionMetadata)==null?void 0:W.priority)||0)+1;v=g.t(a8.entries());for(CN=
v.next();!CN.done;CN=v.next())UH=CN.value,o8=g.t(UH),Q=o8.next().value,km=o8.next().value,Jz=Q,yX=km,$m.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Jz,"musicTrack",A,wh,Ra(b,yX)));OH=g.t(u6.entries());for(wM=OH.next();!wM.done;wM=OH.next())D1=wM.value,w8=g.t(D1),rM=w8.next().value,h3=w8.next().value,Dg=rM,dq=h3,$m.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Dg,"musicTrack",A,wh,Ra(b,dq)));MG=g.t(d8);for(sc=MG.next();!sc.done;sc=MG.next())hO=sc.value,$m.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
hO,"musicTrack",0,wh));return NN.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,$m))}})},AkM=function(S,b){var C,z;
return g.O(function(U){switch(U.J){case 1:return C=yT(b),g.u2(U,2),z=g.Lh(b.entityKey).entityId,z==="!*$_ALL_ENTITIES_!*$"?g.l(U,mI(S.J,b,S.Y),5):g.l(U,fY(z,"musicAlbumRelease",S.J,b,S.Y),6);case 6:return g.l(U,FZ1(S.J,b.entityKey),5);case 5:g.GV(U,3);break;case 2:return g.fN(U),U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},jgX=function(S,b,C){var z,U,a;
return g.O(function(J){switch(J.J){case 1:return g.l(J,kW1([b]),2);case 2:return z=J.K,g.l(J,veU(S,z[0],C),3);case 3:return U=J.K,a=pY(U.thumbnailDetails),g.l(J,ty(a),4);case 4:return J.return(z[0].videos)}})},veU=function(S,b,C){var z,U,a,J,H,B,x,E,d,p,F,T,k,e;
return g.O(function(m){if(m.J==1){z=b.additionalMetadadatas;U=void 0;if(z&&z.length>0)for(a=g.t(z),J=a.next();!J.done;J=a.next())if(H=J.value,H.offlineMusicPlaylistData){U=H.offlineMusicPlaylistData;break}B=b.playlistId;x=TKl(b);E=x.hQ;d=x.oO;p=C?(Number(C)*1E3).toString():Date.now().toString();F=b.lastModifiedTimestamp?(Number(b.lastModifiedTimestamp)*1E3).toString():"0";T={id:g.q2(B,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:d,lastModifiedTimestampMillis:F,addedTimestampMillis:p,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};k={id:g.q2(B,"musicAlbumRelease"),title:b.title,audioPlaylistId:B,trackCount:b.totalVideoCount,tracks:E,downloadMetadata:T.id};U&&(k.thumbnailDetails=(e=U.albumHqThumbnail)!=null?e:U.albumArtistThumbnail,k.artistDisplayName=U.albumArtistDisplayName,k.releaseDate=U.albumReleaseDate,k.contentRating={explicitType:U.albumReleaseExplicitType},k.releaseType=U.albumReleaseType);return g.l(m,Ih(S.J,{mode:"readwrite",He:!0},function(R){var X=MV(R,k,"musicAlbumRelease");
R=MV(R,T,"musicAlbumReleaseDownloadMetadataEntity");return g.u4.all([X,R])}),2)}return m.return(k)})},KfM=function(S,b){this.J=S;
this.Y=b},ck2=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m;
return g.O(function(R){switch(R.J){case 1:return C=yT(b),z=g.Lh(b.entityKey),U=z.entityId,a=[],g.u2(R,2),g.l(R,QgU(S,U),4);case 4:a=R.K;if((J=a)==null||!J.length){R.cS(5);break}return g.l(R,pM6(S.J,b.entityKey),5);case 5:g.GV(R,3);break;case 2:return H=g.fN(R),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.p5&&H.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
R.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,B,x));case 3:return E=[],g.l(R,IVl(S.J,"musicTrack",a),7);case 7:a=R.K;if(a.length)for(d=g.t(a),p=d.next();!p.done;p=d.next())if(F=p.value,T=F.offlineVideoData,k=void 0,(k=T)==null?0:k.videoId)e=void 0,m=Number(((e=b.actionMetadata)==null?void 0:e.priority)||0)+1,E.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",m,LY,Ra(b,T,U)));return R.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,E))}})},
DwO=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8,mR,b6,o5,FX,G,f,W,A,v,CN,UH,o8,Q,km,Jz,yX,OH,wM,D1,w8,rM,h3,Dg,dq,MG,sc,hO,NN,Ix,e_,x1,je,p9,X5,nb,gj,f$,bV,ws;
return g.O(function(U0){switch(U0.J){case 1:return C=yT(b),z=b.entityKey,U=g.Lh(z).entityId,a=[],J=!1,U==="!*$_ALL_ENTITIES_!*$"?(J=!0,g.l(U0,qV(S.J,"musicPlaylist"),5)):g.l(U0,Li(S.J,z,"musicPlaylist"),4);case 4:(H=U0.K)&&a.push(H);U0.cS(3);break;case 5:a=U0.K;case 3:if((B=a)==null||!B.length)return U0.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));x=g.M(b.actionMetadata,Vrk);d=(E=x)==null?void 0:E.autoSync;p=[];T=F=!0;k=!1;e=void 0;if(!J&&d===!1){U0.cS(6);break}g.u2(U0,7);return g.l(U0,
R1c(0,!!d,!0,a),9);case 9:p=U0.K;g.GV(U0,8);break;case 7:m=g.fN(U0);if(!(m instanceof Error&&m.message==="No data")){m instanceof Error&&m.message==="Empty response body"&&zl(m.message);U0.cS(8);break}return U==="!*$_ALL_ENTITIES_!*$"?g.l(U0,mI(S.J,b,S.Y),8):g.l(U0,fY(U,"musicPlaylist",S.J,b,S.Y),8);case 8:if(!p.length||!J&&p[0].playlistId!==U)return U0.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));case 6:if(J){R=[];X=g.t(p);for(K=X.next();!K.done;K=X.next())N=K.value,N.upToDate||
d&&!N.shouldAutoSyncMetadata||!N.playlistId||(b2={autoSync:d},R.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N.playlistId,"musicPlaylist",0,LY,{musicPlaylistEntityActionMetadata:b2})));return U0.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,R))}p.length&&(I=p[0],k=!!I.upToDate,d&&(F=($m=I.shouldAutoSyncMetadata)!=null?$m:!0,T=(a8=I.shouldAutoSyncVideos)!=null?a8:!0,I.checkInSeconds&&(e=I.checkInSeconds)));if(k||!F)return U0.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C));S0=[];Y=a[0];q=void 0;if(!Y.downloadMetadata){U0.cS(15);break}return g.l(U0,Li(S.J,Y.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:P=U0.K,q=Number((QX=(r=P)==null?void 0:r.addedTimestampMillis)!=null?QX:"0")/1E3;case 15:return g.u2(U0,17),g.l(U0,QgU(S,U,(u6=q)==null?void 0:u6.toString(),e),19);case 19:S0=U0.K;g.GV(U0,18);break;case 17:d8=g.fN(U0);if(!(d8 instanceof Error&&d8.message==="No data")){if(d8 instanceof Error&&d8.message==="Empty response body")zl(d8.message);else return mR=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b6="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d8 instanceof g.p5&&d8.type==="QUOTA_EXCEEDED"&&(mR="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b6="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),U0.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,mR,b6));U0.cS(18);break}return g.l(U0,fY(U,"musicPlaylist",S.J,b,S.Y),18);case 18:if(!T)return U0.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C));o5=[];FX=new Map;if((G=S0)==null?0:G.length)for(f=g.t(S0),W=f.next();!W.done;W=f.next())A=W.value,v=A.offlineVideoData,CN=void 0,((CN=v)==null?0:CN.videoId)&&FX.set(v.videoId,v);UH=new Map;o8=[];if((Q=Y)==null?0:(km=Q.tracks)==null?0:km.length)for(Jz=g.t(Y.tracks),yX=Jz.next();!yX.done;yX=Jz.next())if(OH=yX.value,wM=g.Lh(OH).entityId)FX.has(wM)?(UH.set(wM,FX.get(wM)),FX.delete(wM)):o8.push(wM);w8=Number(((D1=b.actionMetadata)==null?void 0:D1.priority)||0)+1;rM=g.t(FX.entries());for(h3=rM.next();!h3.done;h3=
rM.next())Dg=h3.value,dq=g.t(Dg),MG=dq.next().value,sc=dq.next().value,hO=MG,NN=sc,o5.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",hO,"musicTrack",w8,LY,Ra(b,NN)));Ix=g.t(UH.entries());for(e_=Ix.next();!e_.done;e_=Ix.next())x1=e_.value,je=g.t(x1),p9=je.next().value,X5=je.next().value,nb=p9,gj=X5,o5.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",nb,"musicTrack",w8,LY,Ra(b,gj)));f$=g.t(o8);for(bV=f$.next();!bV.done;bV=f$.next())ws=bV.value,o5.push(XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
ws,"musicTrack",0,LY));return U0.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,o5))}})},NeL=function(S,b){var C,z;
return g.O(function(U){switch(U.J){case 1:return C=yT(b),g.u2(U,2),z=g.Lh(b.entityKey).entityId,z==="!*$_ALL_ENTITIES_!*$"?g.l(U,mI(S.J,b,S.Y),5):g.l(U,fY(z,"musicPlaylist",S.J,b,S.Y),6);case 6:return g.l(U,FZ1(S.J,b.entityKey),5);case 5:g.GV(U,3);break;case 2:return g.fN(U),U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},QgU=function(S,b,C,z){var U,a,J;
return g.O(function(H){switch(H.J){case 1:return g.l(H,kW1([b]),2);case 2:return U=H.K,g.l(H,nek(S,U[0],C,z),3);case 3:return a=H.K,J=pY(a.thumbnailDetails),g.l(H,ty(J),4);case 4:return H.return(U[0].videos)}})},nek=function(S,b,C,z){var U,a,J,H,B,x,E,d,p;
return g.O(function(F){return F.J==1?(U=b.playlistId,a=TKl(b),J=a.hQ,H=a.oO,B=C?(Number(C)*1E3).toString():Date.now().toString(),x=b.lastModifiedTimestamp?(Number(b.lastModifiedTimestamp)*1E3).toString():"0",E={id:g.q2(U,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:H,lastModifiedTimestampMillis:x,addedTimestampMillis:B,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},d={id:g.q2(U,"musicPlaylist"),title:b.title,playlistId:U,thumbnailDetails:b.thumbnail,visibility:geX(b),trackCount:b.totalVideoCount,
tracks:J,downloadMetadata:E.id},z&&(((p=d)==null?0:p.entityMetadata)?d.entityMetadata.nextAutoRefreshIntervalSeconds=String(z):d&&(d.entityMetadata={nextAutoRefreshIntervalSeconds:String(z)})),g.l(F,Ih(S.J,{mode:"readwrite",He:!0},function(T){var k=MV(T,d,"musicPlaylist");T=MV(T,E,"musicPlaylistDownloadMetadataEntity");return g.u4.all([k,T])}),2)):F.return(d)})},geX=function(S){switch(S.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},YBU=function(S,b){this.J=S;
this.Y=b},hv8=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T;
return g.O(function(k){switch(k.J){case 1:return C=yT(b),z=g.Lh(b.entityKey),U=z.entityId,a=g.M(b.actionMetadata,M1K),g.u2(k,2),g.l(k,rk2(S,U,void 0,(J=a)==null?void 0:J.track,(H=a)==null?void 0:H.albumRelease),4);case 4:if((B=a)==null?0:B.playlistId){k.cS(5);break}return g.l(k,pM6(S.J,b.entityKey),5);case 5:g.GV(k,3);break;case 2:return x=g.fN(k),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.p5&&x.type==="QUOTA_EXCEEDED"&&
(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),k.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,E,d));case 3:F=Number(((p=b.actionMetadata)==null?void 0:p.priority)||0)+1;var e=(e=g.M(b.actionMetadata,M1K))?{playbackDataActionMetadata:{maximumDownloadQuality:e.maximumDownloadQuality}}:void 0;T=XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U,"playbackData",F,ZQx,e);return k.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C,[T]))}})},ICX=function(S,b){var C,z,U,a,J,H,B,x,E,d,p,F,T,k,e;
return g.O(function(m){switch(m.J){case 1:return C=yT(b),z=g.Lh(b.entityKey),U=z.entityId,g.l(m,Li(S.J,b.entityKey,"musicTrack"),2);case 2:a=m.K;if(!a){J=void 0;m.cS(3);break}return g.l(m,Li(S.J,a.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:J=m.K;case 3:H=J;if(!a||!H)return m.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C));x=g.M(b.actionMetadata,M1K);g.u2(m,5);return g.l(m,rk2(S,U,H.addedTimestampMillis,(E=x)==null?void 0:E.track,(d=x)==null?void 0:d.albumRelease),
7);case 7:F=Number(((p=b.actionMetadata)==null?void 0:p.priority)||0)+1;B=XU("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U,"playbackData",F,ZQx);g.GV(m,6);break;case 5:T=g.fN(m);if(!(T instanceof Error&&T.message==="No data")){if(T instanceof Error&&T.message==="Empty response body")zl(T.message);else return k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.p5&&T.type==="QUOTA_EXCEEDED"&&(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,k,e));m.cS(6);break}return g.l(m,Gl(U,S.J,b,S.Y),6);case 6:return m.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",C,B?[B]:void 0))}})},w$K=function(S,b){var C,z;
return g.O(function(U){switch(U.J){case 1:return C=yT(b),g.u2(U,2),z=g.Lh(b.entityKey).entityId,z==="!*$_ALL_ENTITIES_!*$"?g.l(U,mI(S.J,b,S.Y),5):g.l(U,Gl(z,S.J,b,S.Y),6);case 6:return g.l(U,FZ1(S.J,b.entityKey),5);case 5:g.GV(U,3);break;case 2:return g.fN(U),U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",C,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new OL("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
C))}})},rk2=function(S,b,C,z,U){var a,J,H,B,x,E;
return g.O(function(d){switch(d.J){case 1:if(a=z){d.cS(2);break}return g.l(d,tr5([b]),3);case 3:J=d.K,H=J[0],a=d8m(H);case 2:return g.l(d,Lf6(S,a,b,U,C),4);case 4:B=d.K;x=B.musicTrackEntity;E=B.uG;var p=pY(x.thumbnailDetails),F=[];E&&(F=pY(E.thumbnailDetails));return g.l(d,ty(p.concat(F)),0)}})},Lf6=function(S,b,C,z,U){var a;
return g.O(function(J){return J.J==1?(U||(U=Date.now().toString()),a={id:g.q2(C,"musicTrackDownloadMetadataEntity"),playbackData:g.q2(C,"playbackData"),addedTimestampMillis:U,videoDownloadContextEntity:g.q2(C,"videoDownloadContextEntity")},z&&(b.albumRelease=z.id),g.l(J,Ih(S.J,{mode:"readwrite",He:!0},function(H){var B=[],x=MV(H,a,"musicTrackDownloadMetadataEntity");B.push(x);x=MV(H,b,"musicTrack");B.push(x);z&&(H=MV(H,z,"musicAlbumRelease"),B.push(H));return g.u4.all(B)}),2)):J.J!=3?g.l(J,xf(C,"musicTrackDownloadMetadataEntity",
S.J,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):J.return({musicTrackEntity:b,
uG:z})})},qK=function(){rh.apply(this,arguments);
this.j="musicTrack"},qBm=function(S,b,C){b=b===void 0?43200:b;
C=C===void 0?!0:C;var z=z===void 0?!1:z;var U,a;return g.O(function(J){switch(J.J){case 1:if(!S.B.uD())return J.return([]);U=[];g.u2(J,2);return g.l(J,R1c(b,C,z),4);case 4:U=J.K;g.GV(J,3);break;case 2:g.fN(J);case 3:return a=$w2(S,U,C,"musicPlaylist"),J.return(a)}})},S45=function(){g.E8.apply(this,arguments);
var S=this;this.events=new g.ny(this);this.JB=this.player.G();this.FF={hKa:function(){return S.J},
Ng:function(){return S.Ng()},
vH:function(b){return S.vH(b)}}},bpM=function(S){var b;
S=g.M((b=S.getWatchNextResponse())==null?void 0:b.currentVideoEndpoint,g.Cw);if(S==null?0:S.playlistId)var C=S.playlistId;return C},CLU=function(S,b){var C,z,U,a;
return g.O(function(J){if(J.J==1){C=b.clientPlaybackNonce;z={cpn:C,offlineSourceVisualElement:g.uu(b.zE||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};b.K&&(z.videoFmt=Number(b.K.itag));b.C&&(z.audioFmt=Number(b.C.itag));if((U=bpM(b))&&b.videoId){var H=b.videoId;H=U!=="PPSV"?Promise.resolve(!1):S.J.Eu(H);J=g.l(J,H,3)}else J=J.cS(2);return J}J.J!=2&&(a=J.K)&&(z.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");S.K=C;g.yc("offlinePlaybackStarted",z);g.tz(J)})};
g.lp.prototype.cJ=g.H2(51,function(S){return this.app.cJ(S)});
g.ER.prototype.cJ=g.H2(50,function(S){return g.tKd(this,9,S)});
g.V(Ki,ve);g.B2.Object.defineProperties(Ki.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.J.entityMetadata},
set:function(S){this.J.entityMetadata=S}}});
g.V(ZbX,Ki);ZbX.prototype.K=function(){return[]};
g.V(hOx,Ki);hOx.prototype.K=function(){return[]};
g.V(IYm,Ki);IYm.prototype.K=function(){return[]};
g.V(wDU,Ki);wDU.prototype.K=function(){return[]};
g.V(LWL,Ki);LWL.prototype.K=function(){var S=[];this.J.alternateChannel&&S.push(this.J.alternateChannel);this.J.alternateChannelList&&S.push.apply(S,g.u(this.J.alternateChannelList));this.J.oneofChannelEntity&&S.push(this.J.oneofChannelEntity);return[].concat(g.u(new Set(S)))};
g.V(qy2,Ki);qy2.prototype.K=function(){var S=[];this.J.entryCollection&&S.push(this.J.entryCollection);return[].concat(g.u(new Set(S)))};
g.V(ST8,ve);ST8.prototype.K=function(){var S=[];this.J.video&&S.push(this.J.video);return[].concat(g.u(new Set(S)))};
g.V(bak,Ki);bak.prototype.K=function(){var S=[];this.J.parentPlaylist&&S.push(this.J.parentPlaylist);if(this.J.entries)for(var b=g.t(this.J.entries),C=b.next();!C.done;C=b.next())S.push.apply(S,g.u((new ST8(C.value)).K()));return[].concat(g.u(new Set(S)))};
g.V(CHX,Ki);CHX.prototype.K=function(){var S=[];this.J.descriptionEntity&&S.push(this.J.descriptionEntity);this.J.creators&&S.push.apply(S,g.u(this.J.creators));this.J.theBiggestFan&&S.push(this.J.theBiggestFan);return[].concat(g.u(new Set(S)))};
g.V(ia8,Ki);ia8.prototype.K=function(){return[]};
g.V(zQk,Ki);zQk.prototype.K=function(){return[]};
g.V($Jm,Ki);$Jm.prototype.K=function(){return[]};
g.V(UJU,Ki);UJU.prototype.K=function(){return[]};
g.V(a0l,Ki);a0l.prototype.K=function(){return[]};
g.V(oMX,Ki);oMX.prototype.K=function(){return[]};
g.V(J_L,Ki);J_L.prototype.K=function(){return[]};
g.V(y_8,Ki);y_8.prototype.K=function(){return[]};
g.V(Ha6,Ki);Ha6.prototype.K=function(){return[]};
g.V(BTx,Ki);BTx.prototype.K=function(){var S=[];this.J.downloadsList&&S.push(this.J.downloadsList);this.J.smartDownloadsList&&S.push(this.J.smartDownloadsList);this.J.recommendedDownloadsList&&S.push(this.J.recommendedDownloadsList);this.J.refresh&&S.push(this.J.refresh);return[].concat(g.u(new Set(S)))};
g.V(sPL,ve);sPL.prototype.K=function(){var S=[];this.J.video&&S.push(this.J.video);this.J.playlist&&S.push(this.J.playlist);this.J.videoItem&&S.push(this.J.videoItem);this.J.playlistItem&&S.push(this.J.playlistItem);return[].concat(g.u(new Set(S)))};
g.V(xJK,Ki);xJK.prototype.K=function(){var S=[];this.J.refresh&&S.push(this.J.refresh);if(this.J.downloads)for(var b=g.t(this.J.downloads),C=b.next();!C.done;C=b.next())S.push.apply(S,g.u((new sPL(C.value)).K()));return[].concat(g.u(new Set(S)))};
g.V(EMM,Ki);EMM.prototype.K=function(){var S=[];this.J.localImageEntities&&S.push.apply(S,g.u(this.J.localImageEntities));return[].concat(g.u(new Set(S)))};
g.V(dJO,Ki);dJO.prototype.K=function(){var S=[];this.J.playbackData&&S.push(this.J.playbackData);this.J.localImageEntities&&S.push.apply(S,g.u(this.J.localImageEntities));this.J.videoDownloadContextEntity&&S.push(this.J.videoDownloadContextEntity);return[].concat(g.u(new Set(S)))};
g.V(pU2,Ki);pU2.prototype.K=function(){return[]};
g.V(Fz8,Ki);Fz8.prototype.K=function(){var S=[];this.J.fakeChildren&&S.push.apply(S,g.u(this.J.fakeChildren));return[].concat(g.u(new Set(S)))};
g.V(TT8,Ki);TT8.prototype.K=function(){var S=[];this.J.video&&S.push(this.J.video);this.J.playbackData&&S.push(this.J.playbackData);this.J.offlineVideoPolicy&&S.push(this.J.offlineVideoPolicy);return[].concat(g.u(new Set(S)))};
g.V(V8k,Ki);V8k.prototype.K=function(){return[]};
g.V(PH2,Ki);PH2.prototype.K=function(){var S=[];this.J.channelOwner&&S.push(this.J.channelOwner);this.J.videos&&S.push.apply(S,g.u(this.J.videos));this.J.collaboratorChannels&&S.push.apply(S,g.u(this.J.collaboratorChannels));this.J.downloadState&&S.push(this.J.downloadState);this.J.refresh&&S.push(this.J.refresh);return[].concat(g.u(new Set(S)))};
g.V(t8X,Ki);t8X.prototype.K=function(){var S=[];this.J.video&&S.push(this.J.video);this.J.channelContributor&&S.push(this.J.channelContributor);return[].concat(g.u(new Set(S)))};
g.V(kH8,ve);kH8.prototype.K=function(){var S=[];this.J.localImageEntities&&S.push.apply(S,g.u(this.J.localImageEntities));this.J.videoDownloadContextEntity&&S.push(this.J.videoDownloadContextEntity);return[].concat(g.u(new Set(S)))};
g.V(ukX,ve);ukX.prototype.K=function(){var S=[];this.J.recommendedVideoMetadata&&S.push.apply(S,g.u((new kH8(this.J.recommendedVideoMetadata)).K()));return[].concat(g.u(new Set(S)))};
g.V(eQ2,ve);eQ2.prototype.K=function(){var S=[];this.J.playbackPosition&&S.push(this.J.playbackPosition);return[].concat(g.u(new Set(S)))};
g.V(GHx,Ki);GHx.prototype.K=function(){var S=[];this.J.owner&&S.push(this.J.owner);this.J.downloadState&&S.push(this.J.downloadState);this.J.userState&&S.push.apply(S,g.u((new eQ2(this.J.userState)).K()));this.J.additionalMetadata&&S.push.apply(S,g.u((new ukX(this.J.additionalMetadata)).K()));return[].concat(g.u(new Set(S)))};
g.V(f0M,Ki);f0M.prototype.K=function(){var S=[];this.J.userChannelDetails&&S.push(this.J.userChannelDetails);return[].concat(g.u(new Set(S)))};
g.V(mJK,Ki);mJK.prototype.K=function(){var S=[];this.J.channelOwner&&S.push(this.J.channelOwner);this.J.playbackPosition&&S.push(this.J.playbackPosition);this.J.localImageEntities&&S.push.apply(S,g.u(this.J.localImageEntities));this.J.downloadStatus&&S.push(this.J.downloadStatus);return[].concat(g.u(new Set(S)))};
g.V(RQO,Ki);RQO.prototype.K=function(){return[]};
g.V(WzK,Ki);WzK.prototype.K=function(){return[]};
g.V(l0X,Ki);l0X.prototype.K=function(){return[]};
g.V(jP5,Ki);jP5.prototype.K=function(){return[]};
g.V(XUk,Ki);XUk.prototype.K=function(){return[]};
g.V(Oax,Ki);Oax.prototype.K=function(){return[]};
g.V(A_8,Ki);A_8.prototype.K=function(){return[]};
g.V(vMk,Ki);vMk.prototype.K=function(){return[]};
g.V(Kz5,Ki);Kz5.prototype.K=function(){return[]};
g.V(QPk,Ki);QPk.prototype.K=function(){return[]};
g.V(c_c,Ki);c_c.prototype.K=function(){return[]};
g.V(DJl,Ki);DJl.prototype.K=function(){var S=[];this.J.trackDownloadMetadatas&&S.push.apply(S,g.u(this.J.trackDownloadMetadatas));return[].concat(g.u(new Set(S)))};
g.V(NTx,Ki);
NTx.prototype.K=function(){var S=[];this.J.downloadedTracks&&S.push.apply(S,g.u(this.J.downloadedTracks));this.J.smartDownloadedTracks&&S.push.apply(S,g.u(this.J.smartDownloadedTracks));this.J.downloadedEpisodes&&S.push.apply(S,g.u(this.J.downloadedEpisodes));this.J.downloadedAlbumReleases&&S.push.apply(S,g.u(this.J.downloadedAlbumReleases));this.J.smartDownloadedAlbumReleases&&S.push.apply(S,g.u(this.J.smartDownloadedAlbumReleases));this.J.downloadedPlaylists&&S.push.apply(S,g.u(this.J.downloadedPlaylists));this.J.smartDownloadedPlaylists&&
S.push.apply(S,g.u(this.J.smartDownloadedPlaylists));this.J.metadataOnlyTracks&&S.push.apply(S,g.u(this.J.metadataOnlyTracks));return[].concat(g.u(new Set(S)))};
g.V(nMl,Ki);nMl.prototype.K=function(){var S=[];this.J.trackDownloadMetadatas&&S.push.apply(S,g.u(this.J.trackDownloadMetadatas));return[].concat(g.u(new Set(S)))};
g.V(gM6,Ki);gM6.prototype.K=function(){var S=[];this.J.playbackData&&S.push(this.J.playbackData);this.J.localImageEntities&&S.push.apply(S,g.u(this.J.localImageEntities));this.J.videoDownloadContextEntity&&S.push(this.J.videoDownloadContextEntity);return[].concat(g.u(new Set(S)))};
g.V(YTO,Ki);YTO.prototype.K=function(){var S=[];this.J.musicLibraryStatusEntity&&S.push(this.J.musicLibraryStatusEntity);this.J.primaryArtists&&S.push.apply(S,g.u(this.J.primaryArtists));this.J.details&&S.push(this.J.details);this.J.userDetails&&S.push(this.J.userDetails);this.J.tracks&&S.push.apply(S,g.u(this.J.tracks));this.J.share&&S.push(this.J.share);this.J.downloadMetadata&&S.push(this.J.downloadMetadata);this.J.refresh&&S.push(this.J.refresh);return[].concat(g.u(new Set(S)))};
g.V(M8l,Ki);M8l.prototype.K=function(){var S=[];this.J.albumRelease&&S.push(this.J.albumRelease);this.J.tracks&&S.push.apply(S,g.u(this.J.tracks));return[].concat(g.u(new Set(S)))};
g.V(r_2,Ki);r_2.prototype.K=function(){var S=[];this.J.albumRelease&&S.push(this.J.albumRelease);return[].concat(g.u(new Set(S)))};
g.V(Za8,Ki);Za8.prototype.K=function(){var S=[];this.J.details&&S.push(this.J.details);this.J.userDetails&&S.push(this.J.userDetails);return[].concat(g.u(new Set(S)))};
g.V(hQ6,Ki);hQ6.prototype.K=function(){var S=[];this.J.parentArtist&&S.push(this.J.parentArtist);return[].concat(g.u(new Set(S)))};
g.V(I0O,Ki);I0O.prototype.K=function(){var S=[];this.J.parentArtist&&S.push(this.J.parentArtist);return[].concat(g.u(new Set(S)))};
g.V(wUM,Ki);wUM.prototype.K=function(){return[]};
g.V(LzU,Ki);LzU.prototype.K=function(){return[]};
g.V(qTk,ve);qTk.prototype.K=function(){var S=[];this.J.creatorEntity&&S.push(this.J.creatorEntity);return[].concat(g.u(new Set(S)))};
g.V(SA1,Ki);
SA1.prototype.K=function(){var S=[];this.J.tracks&&S.push.apply(S,g.u(this.J.tracks));this.J.refresh&&S.push(this.J.refresh);this.J.musicLibraryStatusEntity&&S.push(this.J.musicLibraryStatusEntity);this.J.details&&S.push(this.J.details);this.J.downloadMetadata&&S.push(this.J.downloadMetadata);this.J.sideloadMetadata&&S.push(this.J.sideloadMetadata);this.J.userDetails&&S.push(this.J.userDetails);this.J.entryCollection&&S.push(this.J.entryCollection);this.J.share&&S.push(this.J.share);this.J.podcastShowAdditionalMetadata&&S.push.apply(S,
g.u((new qTk(this.J.podcastShowAdditionalMetadata)).K()));return[].concat(g.u(new Set(S)))};
g.V(bUO,Ki);bUO.prototype.K=function(){return[]};
g.V(Com,Ki);
Com.prototype.K=function(){var S=[];this.J.musicLibraryStatusEntity&&S.push(this.J.musicLibraryStatusEntity);this.J.artists&&S.push.apply(S,g.u(this.J.artists));this.J.audioModeVersion&&S.push(this.J.audioModeVersion);this.J.videoModeVersion&&S.push(this.J.videoModeVersion);this.J.userDetails&&S.push(this.J.userDetails);this.J.details&&S.push(this.J.details);this.J.albumRelease&&S.push(this.J.albumRelease);this.J.share&&S.push(this.J.share);this.J.libraryEdit&&S.push(this.J.libraryEdit);this.J.downloadMetadata&&
S.push(this.J.downloadMetadata);this.J.playbackPosition&&S.push(this.J.playbackPosition);this.J.lyrics&&S.push(this.J.lyrics);return[].concat(g.u(new Set(S)))};
g.V(iUx,Ki);iUx.prototype.K=function(){var S=[];this.J.parentTrack&&S.push(this.J.parentTrack);return[].concat(g.u(new Set(S)))};
g.V(zgL,Ki);zgL.prototype.K=function(){var S=[];this.J.parentTrack&&S.push(this.J.parentTrack);return[].concat(g.u(new Set(S)))};
g.V($IM,Ki);$IM.prototype.K=function(){return[]};
g.V(UIc,Ki);UIc.prototype.K=function(){return[]};
g.V(az5,Ki);az5.prototype.K=function(){return[]};
g.V(oHc,Ki);oHc.prototype.K=function(){return[]};
g.V(JBx,Ki);JBx.prototype.K=function(){var S=[];this.J.transfer&&S.push(this.J.transfer);this.J.adsPlaybackData&&S.push.apply(S,g.u(this.J.adsPlaybackData));this.J.drmLicense&&S.push(this.J.drmLicense);this.J.offlineVideoPolicy&&S.push(this.J.offlineVideoPolicy);this.J.videoDownloadContextEntity&&S.push(this.J.videoDownloadContextEntity);return[].concat(g.u(new Set(S)))};
g.V(yB2,Ki);yB2.prototype.K=function(){return[]};
g.V(HUm,Ki);HUm.prototype.K=function(){var S=[];this.J.offlineVideoStreams&&S.push.apply(S,g.u(this.J.offlineVideoStreams));this.J.captionTrack&&S.push.apply(S,g.u(this.J.captionTrack));return[].concat(g.u(new Set(S)))};
g.V(B$6,Ki);B$6.prototype.K=function(){return[]};
g.V(sfL,Ki);sfL.prototype.K=function(){return[]};
g.V(xIc,Ki);xIc.prototype.K=function(){return[]};
g.V(EHX,Ki);EHX.prototype.K=function(){return[]};
g.V(dI6,Ki);dI6.prototype.K=function(){return[]};
g.V(plU,Ki);plU.prototype.K=function(){return[]};
g.V(FY5,Ki);FY5.prototype.K=function(){return[]};
g.V(T$K,Ki);T$K.prototype.K=function(){return[]};
g.V(VCL,Ki);VCL.prototype.K=function(){return[]};
g.V(PoX,Ki);PoX.prototype.K=function(){return[]};
g.V(tCX,Ki);tCX.prototype.K=function(){return[]};
g.V(ku6,Ki);ku6.prototype.K=function(){return[]};
g.V(uY6,Ki);uY6.prototype.K=function(){return[]};
g.V(eg1,Ki);eg1.prototype.K=function(){return[]};
g.V(Guc,Ki);Guc.prototype.K=function(){return[]};
g.V(fz5,Ki);fz5.prototype.K=function(){return[]};
g.V(mIK,Ki);mIK.prototype.K=function(){return[]};
g.V(RgO,Ki);RgO.prototype.K=function(){return[]};
g.V(WYX,Ki);WYX.prototype.K=function(){return[]};
g.V(lzK,Ki);lzK.prototype.K=function(){return[]};
var WZM=["browse","music/browse","unplugged/browse"],Abk=["offline/playlist_sync_check"],PXl=["offline"],l78=["offline/offline_video_playback_position_sync"],XMm=["offline/get_playback_data_entity"],Q5;ce.getInstance=function(){return g.O(function(S){return S.return(new Promise(function(b){g.q6().then(function(C){C?(ce.instance||(ce.instance=new ce(C)),b(ce.instance)):b(void 0)})}))})};
ce.prototype.get=function(S){var b=this,C,z,U;return g.O(function(a){if(a.J==1)return g.l(a,ABK(b.token),2);if(a.J!=3)return C=a.K,g.l(a,C.get("prefs",S),3);z=a.K;if(!z)return a.return();U=(0,g.mC)();return z.expirationTimestampMs<=U?a.return():a.return(z.value)})};
ce.prototype.set=function(S,b,C){C=C===void 0?31536E3:C;var z=this,U,a,J;return g.O(function(H){if(H.J==1)return U=(0,g.mC)(),a={key:S,value:b,expirationTimestampMs:U+C*1E3},g.l(H,ABK(z.token),2);J=H.K;return g.l(H,g.OD(J,"prefs",a),0)})};
ce.prototype.remove=function(S){var b=this,C;return g.O(function(z){if(z.J==1)return g.l(z,ABK(b.token),2);C=z.K;return g.l(z,C.delete("prefs",S),0)})};
g.V(D4,g.ZL);g.V(NV,DI1);NV.prototype.Y=function(S,b){b=nH6(b);S=(new TextEncoder).encode(JSON.stringify(S));return this.J.encrypt(S,b)};
NV.prototype.K=function(S,b){if(!(S instanceof Uint8Array))throw vHK(1);var C=new TextDecoder;b=nH6(b);S=this.J.decrypt(S,b);return JSON.parse(C.decode(S))};
var gHx={accountLinkStatusEntity:$Jm,booleanEntity:IYm,buttonEntity:uY6,captionTrack:$IM,channelHandle:ZbX,commerceAcquisitionClientPayloadEntity:Guc,commerceCartListEntity:fz5,contextNoteFeedEntityPayload:hOx,continuationTokenEntity:V8k,downloadQualityPickerEntity:J_L,downloadsPageRefreshTokenEntity:Ha6,downloadsPageViewConfigurationEntity:RQO,downloadStatusEntity:y_8,dismissState:FY5,sfvAudioItemCurrentlyPlayingEntity:EHX,emojiFountainDataEntity:tCX,emojiCustomizationSetEntity:PoX,fakeChannel:LWL,
fakePlaylist:qy2,fakePlaylistEntryCollection:bak,fakeVideo:CHX,fakeVideoDescription:ia8,featuredProductsEntity:Kz5,flowStateEntity:zQk,iconBadgeEntity:mIK,interstitialInteractionStateEntity:a0l,likeButtonAnimationEntity:WzK,liveChatPollStateEntity:oMX,liveViewerLeaderboardChatEntryPointStateEntity:sfL,liveViewerLeaderboardPointsEntity:xIc,liveReactionsDataEntity:ku6,logoEntity:UJU,macroMarkerEntity:l0X,mainDownloadsLibraryEntity:BTx,mainDownloadsListEntity:xJK,mainPlaylistDownloadStateEntity:EMM,
mainPlaylistEntity:PH2,mainPlaylistVideoEntity:t8X,mainVideoDownloadStateEntity:dJO,mainVideoEntity:GHx,markersEngagementPanelSyncEntity:jP5,markersVisibilityOverrideEntity:XUk,musicAlbumReleaseDetail:M8l,musicAlbumReleaseDownloadMetadataEntity:DJl,musicAlbumRelease:YTO,musicAlbumReleaseUserDetail:r_2,musicArtistDetail:hQ6,musicArtist:Za8,musicArtistUserDetail:I0O,musicDownloadsLibraryEntity:NTx,musicLibraryEdit:wUM,musicLibraryStatusEntity:LzU,musicPlaylist:SA1,musicPlaylistDownloadMetadataEntity:nMl,
musicShare:bUO,musicTrackDetail:iUx,musicTrackDownloadMetadataEntity:gM6,musicTrack:Com,musicTrackUserDetail:zgL,offlineOrchestrationActionWrapperEntity:UIc,offlineVideoPolicy:az5,offlineVideoStreams:oHc,offlineabilityEntity:pU2,orchestrationWebSamplingEntity:Fz8,pageHeaderEntity:T$K,pdpStateEntity:RgO,pinnedProductEntity:QPk,playbackData:JBx,playerStateEntity:Oax,quantityIncrementerEntity:WYX,refresh:yB2,saveToPlaylistListEntity:dI6,settingEntity:plU,stringEntity:wDU,suggestedFeedbackChipStateEntity:A_8,
transfer:HUm,trendingOfferEntity:c_c,videoDownloadContextEntity:B$6,videoOverviewAsyncDataEntity:lzK,videoPlaybackPositionEntity:eg1,votingEntity:VCL,ytMainChannelEntity:f0M,youchatPendingResponseEntity:vMk,ytMainDownloadedVideoEntity:TT8,ytMainVideoEntity:mJK};g.V(Z4,DI1);Z4.prototype.Y=function(S){return S};
Z4.prototype.K=function(S){if(S instanceof Uint8Array)throw vHK(0);return S};
g.V(hR,g.D);hR.prototype.observe=function(S){var b=this;this.observers.push(S);return function(){var C=b.observers.indexOf(S);C>=0&&b.observers.splice(C,1)}};
hR.prototype.K=function(S){zT2(this,S.data)};
hR.prototype.FB=function(){this.channel.close()};
var Jt2,a7x=new g.fQ("elementsCommand");var u0=new g.fQ("entityBatchUpdate");var hTk=new g.fQ("downloadStatusEntity");var HQl=new g.fQ("mainPlaylistEntityActionMetadata");var Ia=new g.fQ("mainVideoEntityActionMetadata");var Vrk=new g.fQ("musicPlaylistEntityActionMetadata");var M1K=new g.fQ("musicTrackEntityActionMetadata");var G6L=new g.fQ("localImageEntityActionMetadata");var Ay=new g.fQ("playbackDataActionMetadata");var ogL=new g.fQ("transferEntityActionMetadata");var rbU=new g.fQ("videoPlaybackPositionEntityActionMetadata");var uaO;new g.H7;new g.H7;RTX.prototype.request=function(S,b,C){b=b===void 0?{}:b;return this.locks.request(S,b,function(z){return C(z)})};var i0=g.Ym.caches,CY,OtU;b0.prototype.open=function(S){return i0.open(jHm(S))};
b0.prototype.has=function(S){return i0.has(jHm(S))};
b0.prototype.delete=function(S){return i0.delete(jHm(S))};
b0.prototype.match=function(S,b){var C=this,z,U,a,J,H,B;return g.O(function(x){switch(x.J){case 1:return g.l(x,C.keys(),2);case 2:z=x.K,U=g.t(z),a=U.next();case 3:if(a.done){x.cS(5);break}J=a.value;return g.l(x,C.open(J),6);case 6:return H=x.K,g.l(x,H.match(S,b),7);case 7:if(B=x.K)return x.return(B);a=U.next();x.cS(3);break;case 5:return x.return()}})};
g.V(lVl,b0);lVl.prototype.keys=function(){var S,b,C,z,U,a,J,H,B;return g.O(function(x){if(x.J==1)return S=[],b=g.hq("CacheStorage keys"),g.l(x,i0.keys(),2);C=x.K;z=g.t(C);for(U=z.next();!U.done;U=z.next()){a=U.value;var E=a.indexOf(":");J=E===-1?{Sf:a}:{Sf:a.substring(0,E),datasyncId:a.substring(E+1)};H=J.Sf;B=J.datasyncId;B===b&&S.push(H)}return x.return(S)})};g.V($f,g.D);$f.prototype.Y=function(S){this.api.xQ("onOfflineOperationFailure",S.data)};
$f.prototype.C=function(S){this.api.publish("offlinetransferpause",S.data)};
$f.prototype.FB=function(){var S;(S=this.J)==null||S.close();var b;(b=this.K)==null||b.close()};KaL.prototype.va=function(){this.J&&aa(this)};
KaL.prototype.hc=function(){this.K&&this.K.resolve();this.Y=this.J=!1;this.j()};var uAx=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var z1x="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var EEc="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.V(KZl,jF);KZl.prototype.K=function(S){return HE(S)?D8L(this,S):BE(S)?gEl(this,S):Promise.reject(Error("Unsupported action type: "+S.actionType))};g.V(YNc,jF);YNc.prototype.K=function(S){return BE(S)?MrU(this,S):Ztc(S)?ZHK(this,S):sL(S)?h16(this,S):Promise.reject(Error("Unsupported action type: "+S.actionType))};g.y=I7L.prototype;g.y.BYH=function(S){var b=this,C,z,U,a;return g.O(function(J){if(!g.h(S.state,128))return J.cS(0);C=S.state.Ys;var H=(z=C)==null?void 0:z.errorCode,B=(U=C)==null?void 0:U.LN;a=H==="net.connect"&&B===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(H==null?0:H.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.l(J,b.S_(b.player.getVideoData().videoId,a),0)})};
g.y.S_=function(S,b){var C=this;return g.O(function(z){if(z.J==1){if(C.K)return z.return();C.K=!0;return b==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(QT(C,S,!1,!0),z.cS(0)):g.l(z,KY(C,S),3)}g.OU(S,4);return g.l(z,C.J.S_(b),0)})};
g.y.Ae=function(S){S.status===2?(S.status!==this.Y&&(Ms5(this.J),g.OU(S.videoId,2)),S.N6&&wfL(this.J,S.videoId,S.N6)):S.status===4?(KY(this,S.videoId),this.S_(S.videoId,S.Mg?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):S.status===1&&Is8(this.J);this.Y=S.status;this.api.xQ("localmediachange",{videoId:S.videoId,status:S.status})};
g.y.x9=function(){var S=this,b;return g.O(function(C){if(C.J==1){if(S.K)return C.return();S.K=!0;b=S.player.getVideoData().videoId;return g.l(C,KY(S,b),2)}return g.l(C,S.J.x9(),0)})};
g.y.Hb=function(S){switch(S){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.y.L=function(S){return this.api.G().L(S)};g.V(iG2,jF);iG2.prototype.K=function(S){return HE(S)?$p6(this,S):BE(S)?Upc(this,S):Ztc(S)?asc(this,S):Promise.reject(Error("Unsupported action type: "+S.actionType))};s95.prototype.J=function(S,b){var C=S.action.actionMetadata.priority-b.action.actionMetadata.priority;C===0&&(S.J<b.J?C=-1:S.J>b.J&&(C=1));return C};g.V(cE,g.D);cE.prototype.FB=function(){this.j&&this.j();g.D.prototype.FB.call(this)};
cE.prototype.createAction=function(S,b){var C=g.Lh(S.entityKey).entityType,z=g.uZ(16);return new FU(C,z,S,b.actionId,b.rootActionId)};
cE.prototype.kQ=function(S){var b=this,C,z,U,a,J,H,B,x,E;return g.O(function(d){if(d.J==1){if(b.AB())return d.return();z=(C=S.offlineOrchestrationActionWrapperEntity)!=null?C:new Set;U=[];a=g.t(z);for(J=a.next();!J.done;J=a.next())H=J.value,B=g.Lh(H),x=B.entityId,dp2(b.J,x)||U.push(H);return g.l(d,fsl(b,U),2)}E=d.K;return g.l(d,GPM(b,E),0)})};
cE.prototype.retry=function(){var S=this;return g.O(function(b){return g.l(b,mp2(S),0)})};W51.prototype.kK=function(S,b){b=b===void 0?!0:b;var C=this,z,U,a,J,H,B,x,E;return g.O(function(d){switch(d.J){case 1:if(!C.J)return d.return();z=[];U=g.ic(C.J.K,b);a=[];for(J={Q8:0};J.Q8<U.length;J={Q8:J.Q8},J.Q8++)H=U[J.Q8],B=C.J.mH(H,"json3"),x=g.W_(B,{withCredentials:!0,format:"RAW"},3,500).then(function(p){return function(F){F={metadata:g.Tc(U[p.Q8]),trackData:F.xhr.responseText};a.push(F)}}(J)).CU(function(p){zl("Caption fetch error",p)}),z.push(x);
return g.l(d,r$6(z),2);case 2:return g.u2(d,3),g.l(d,p7L(S,a),5);case 5:g.GV(d,0);break;case 3:E=g.fN(d),zl("Caption DB transaction error",E),g.tz(d)}})};g.V(Dh,g.D);Dh.prototype.FB=function(){this.K&&this.K();g.D.prototype.FB.call(this)};
Dh.prototype.Y=function(S){var b=this,C,z,U,a,J,H,B,x;return g.O(function(E){z=(C=S.transfer)!=null?C:new Set;U=[];a=g.t(z);for(J=a.next();!J.done;J=a.next())H=J.value,B=g.Lh(H),x=B.entityId,U.push(x);return U.length===0?E.return():g.l(E,Xfk(b,U),0)})};g.V(Q9K,g.D);g.y=Q9K.prototype;g.y.FB=function(){this.sG&&this.sG();this.hB.dispose();this.C.dispose();this.UG&&g.qJ(this.B.GK,this.UG);this.BS&&g.qJ(this.B.GK,this.BS);g.D.prototype.FB.call(this)};
g.y.M6x=function(S){var b=this,C,z,U;return g.O(function(a){switch(a.J){case 1:C=g.q2(S,"transfer");if(b.J&&C===b.J.key){QT(b.T,b.D,!0);b.C.stop();a.cS(0);break}return g.l(a,Ih(b.K,{mode:"readwrite",He:!0},function(J){return ni(J,C,"transfer").then(function(H){if(H&&H.transferState!=="TRANSFER_STATE_COMPLETE"&&H.transferState!=="TRANSFER_STATE_FAILED")return H.transferState="TRANSFER_STATE_PAUSED_BY_USER",MV(J,H,"transfer").then(function(){return H})})}),3);
case 3:z=a.K;if(!z){a.cS(0);break}if(!S||!b.Y){a.cS(5);break}return g.l(a,xf(S,b.Y,b.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.l(a,gh(b,S),7);case 7:U=a.K,MqM({videoId:S,U3:z,offlineModeType:U}),g.tz(a)}})};
g.y.OPQ=function(){var S=this;if(this.J&&this.D){QT(this.T,this.D,!1);var b=this.J,C=(b==null?0:b.key)?g.Lh(b.key).entityId:"";C&&this.Y&&(new Promise(function(z,U){xf(C,S.Y,S.K,"DOWNLOAD_STATE_PAUSED").catch(function(a){U(a)})})).catch(function(z){zl("Download state setting error",z)})}this.C.stop()};
g.y.CA=function(){this.J?NbK(this,this.J):nY(this)};
g.y.h6=function(S){var b=this;return g.O(function(C){switch(C.J){case 1:if(!b.J){C.cS(2);break}if(b.J.transferState==="TRANSFER_STATE_COMPLETE"||b.J.transferState==="TRANSFER_STATE_FAILED"||!S.transfer||!S.transfer.has(b.J.key)){C.cS(3);break}return g.l(C,Li(b.K,b.J.key,"transfer"),4);case 4:b.J=C.K;if(b.J){C.cS(3);break}return g.l(C,ngX(b),3);case 3:if(b.J)return C.return();case 2:return g.l(C,nY(b),0)}})};
g.y.S_=function(S,b){var C=this,z,U,a,J,H;return g.O(function(B){switch(B.J){case 1:if(!C.J){Yf(C,"onTransferFailure: "+S);B.cS(2);break}z=C.J;a=((U=z)==null?0:U.key)?g.Lh(z.key).entityId:"";a:switch(S){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var x=!1;break a;default:x=!0}return x&&L5k(C)?g.l(B,MK(C,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.l(B,
qp5(C,S),5);case 5:if(!a||!C.Y){B.cS(2);break}return g.l(B,xf(a,C.Y,C.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.l(B,gh(C,a),9);case 9:J=B.K;Jy({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:a,U3:z,offlineModeType:J});if(!a||!C.Y){B.cS(2);break}return g.l(B,xf(a,C.Y,C.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:NK(C),H=nY(C,!0),b&&b(H),g.tz(B)}})};
g.y.x9=function(S){var b=this,C,z,U,a,J,H,B,x,E,d,p,F;return g.O(function(T){switch(T.J){case 1:if(!b.J){Yf(b,"onMaybeTransferStreamsExpired");T.cS(2);break}return L5k(b)?g.l(T,MK(b,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.l(T,qp5(b,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!b.Y){T.cS(2);break}C=b.J;U=((z=C)==null?0:z.key)?g.Lh(C.key).entityId:"";if(!U){T.cS(2);break}return g.l(T,xf(U,b.Y,b.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return b.J||Yf(b,"onMaybeTransferStreamsExpiredRetryAttempting"),
a=b.J,H=((J=a)==null?0:J.key)?g.Lh(a.key).entityId:"",g.l(T,gh(b,H),10);case 10:return B=T.K,Jy({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:H,U3:a,offlineModeType:B}),x=La6(),g.Nm(x,Ay,{isEnqueuedForExpiredStreamUrlRefetch:!0}),E=g.q2(H,"playbackData"),d={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:E,actionMetadata:x},p=VT(new FU("playbackData",H,d)),g.l(T,wm(b.K,p,"offlineOrchestrationActionWrapperEntity"),2);case 2:NK(b),F=nY(b,!0),
S&&S(F),g.tz(T)}})};
var ip8={},SBL=(ip8.TRANSFER_STATE_TRANSFERRING=1,ip8.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,ip8);g.y=rh.prototype;g.y.uY=function(){return this.D.promise};
g.y.GX=function(){if(this.K&&this.T)return this.D.promise;iQL(this).then(this.D.resolve).catch(this.D.reject);return this.D.promise};
g.y.OF=function(S){var b={};return b.playbackData=new KZl(S,this.JB,this.J),b.transfer=new iG2(S,this.JB),b.videoPlaybackPositionEntity=new YNc(S,this.JB),b};
g.y.YA=function(){var S=this;return g.O(function(b){return S.K?g.l(b,c6c(S.K),0):b.cS(0)})};
g.y.xA=function(){var S=this,b,C;return g.O(function(z){if(z.J==1)return S.K||S.T?g.l(z,S.uY(),2):z.return();S.X!==void 0&&(g.TS(S.X),S.X=void 0);S.C!==void 0&&(g.TS(S.C),S.C=void 0);(b=S.K)==null||b.dispose();S.K=void 0;(C=S.T)==null||C.dispose();S.T=void 0;S.api.xQ("onOrchestrationLostLeader");S.D=new g.H7;g.tz(z)})};
g.y.isOrchestrationLeader=function(){return this.Y.J};
g.y.Eu=function(){return g.O(function(S){return S.return(!1)})};
g.y.V$=function(S){var b=this.J;b.api.publish("offlinetransferpause",S);var C;(C=b.K)==null||C.postMessage(S)};
g.y.CA=function(S){var b,C;return g.O(function(z){if(z.J==1)return g.l(z,SF(),2);b=z.K;if(!b)return z.return();C=g.q2(S,"transfer");return g.l(z,Ih(b,{mode:"readwrite",He:!0},function(U){var a=ni(U,C,"transfer"),J=ni(U,g.q2(S,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.u4.all([a,J]).then(function(H){H=g.t(H);var B=H.next().value;var x=H.next().value;return B&&B.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(B.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",MV(U,B,"transfer").then(function(){Jy({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:S,U3:B,offlineModeType:x==null?void 0:x.offlineModeType});return g.u4.resolve(null)})):g.u4.resolve(null)})}),0)})};
g.y.Pz=function(S){S=S===void 0?43200:S;var b=this,C,z,U,a,J,H,B,x;return g.O(function(E){if(E.J==1)return b.B.uD()?g.l(E,SF(),2):E.return(zvL());if(E.J!=3){C=E.K;if(!C)return E.return([]);z=Date.now()/1E3;return g.l(E,qV(C,"offlineVideoPolicy"),3)}U=E.K;a=[];J=g.t(U);for(H=J.next();!H.done;H=J.next())B=H.value,Number(B.lastUpdatedTimestampSeconds)+S<=z&&(x=g.Lh(B.key).entityId,a.push(x));return a.length?E.return(Zh(b,a,b.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):E.return([])})};
g.y.deleteAll=function(){return Zh(this,["!*$_ALL_ENTITIES_!*$"],this.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.y.refreshAllStaleEntities=function(S){var b=this;return g.O(function(C){return C.J==1?g.l(C,b.Pz(S),2):C.return(C.K)})};
g.y.setUpPositionSyncInterval=function(S){var b=this;this.C!==void 0&&(g.TS(this.C),this.C=void 0);var C=S!=null?S:864E5;this.C=g.pp(function(){b.qY(C)},C)};
g.y.qY=function(S){var b=this,C,z,U,a,J,H;return g.O(function(B){switch(B.J){case 1:return g.u2(B,2),g.l(B,ce.getInstance(),4);case 4:C=B.K;if(!C)throw Error("prefStorage is undefined");return g.l(B,C.get("psi"),5);case 5:z=B.K;a=((U=z)==null?0:U.Em)?Number(z.Em)/1E3:0;J=Date.now();if(!(a+S<=J)){B.cS(6);break}return g.l(B,Zh(b,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.GV(B,0);break;case 2:H=g.fN(B),zl("Offline manager error",H),
g.tz(B)}})};
g.y.JG=function(){var S=this,b,C,z,U,a,J,H;return g.O(function(B){if(B.J==1)return g.l(B,SF(),2);if(B.J!=3)return(b=B.K)?g.l(B,qV(b,"transfer"),3):B.return([]);C=B.K;z=[];U=g.t(C);for(a=U.next();!a.done;a=U.next())J=a.value,J.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&J.key&&(H=g.Lh(J.key).entityId,z.push(H));return B.return(UwK(S,z))})};
g.y.oE=function(){return g.O(function(S){return S.return([])})};
g.y.Mz=function(){return g.O(function(S){g.tz(S)})};
g.y.fv=function(){return g.O(function(S){g.tz(S)})};g.V(aC2,jF);aC2.prototype.K=function(S){return HE(S)?yk8(this,S):BE(S)?Bek(this,S):sL(S)?sgl(this,S):Promise.reject(Error("Unsupported action type: "+S.actionType))};
var hy=[10];g.V(Ff5,jF);Ff5.prototype.K=function(S){return HE(S)?PDU(this,S):BE(S)?t1O(this,S):sL(S)?k6l(this,S):Promise.reject(Error("Unsupported action type: "+S.actionType))};
var V1O=[10];g.V(evx,jF);evx.prototype.K=function(S){return BE(S)?fCl(this,S):Promise.reject(Error("Unsupported action type: "+S.actionType))};g.V(mw8,rh);g.y=mw8.prototype;g.y.OF=function(S){var b=rh.prototype.OF.call(this,S);b.mainVideoEntity=new Ff5(S,this.JB,this.J);b.mainPlaylistEntity=new aC2(S,this.JB,this.J);b.mainDownloadsListEntity=new evx(S,this.JB,this.J);return b};
g.y.refreshAllStaleEntities=function(S,b){var C=this,z,U,a,J,H,B,x,E,d,p,F;return g.O(function(T){switch(T.J){case 1:z=[];if(!C.JB.L("web_player_offline_playlist_auto_refresh")){T.cS(2);break}return g.l(T,Rvc(C,S,b),3);case 3:z=T.K;case 2:return g.l(T,ce.getInstance(),4);case 4:return U=T.K,g.l(T,(a=U)==null?void 0:a.get("sdois"),5);case 5:return J=T.K,g.l(T,(H=U)==null?void 0:H.get("lmqf"),6);case 6:B=T.K;if(!J){T.cS(7);break}E=z;d=E.concat;return g.l(T,Wfk(C,J,(x=B)!=null?x:"SD",S===0),8);case 8:z=
d.call(E,T.K);case 7:return p=z,F=p.concat,g.l(T,rh.prototype.refreshAllStaleEntities.call(C,S,b),9);case 9:return z=F.call(p,T.K),T.return(z)}})};
g.y.Eu=function(S){var b,C,z,U,a,J,H,B;return g.O(function(x){if(x.J==1)return g.l(x,SF(),2);if(x.J!=3)return(b=x.K)?g.l(x,Li(b,g.XO,"mainDownloadsListEntity"),3):x.return(!1);C=x.K;if((z=C)==null?0:(U=z.downloads)==null?0:U.length)for(a=g.q2(S,"mainVideoEntity"),J=g.t(C.downloads),H=J.next();!H.done;H=J.next())if(B=H.value,B.videoItem===a)return x.return(!0);return x.return(!1)})};
g.y.oE=function(){var S=this,b,C,z,U,a,J,H,B;return g.O(function(x){if(x.J==1)return g.l(x,SF(),2);if(x.J!=3)return(b=x.K)?g.l(x,qV(b,"downloadStatusEntity"),3):x.return([]);C=x.K;z=[];U=g.t(C);for(a=U.next();!a.done;a=U.next())J=a.value,J.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&J.key&&(H=g.Lh(J.key).entityId,z.push(H));return z.length?(B={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},x.return(Zh(S,z,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
B))):x.return([])})};
g.y.fv=function(){var S;return g.O(function(b){return b.J==1?g.l(b,SF(),2):(S=b.K)?g.l(b,Ih(S,{mode:"readwrite",He:!0},function(C){return gm(C,"mainVideoEntity").then(function(z){var U=[];z=g.t(z);for(var a=z.next();!a.done;a=z.next()){a=a.value;var J=void 0;(J=a.userState)!=null&&J.playbackPosition||(J=g.Lh(a.key).entityId,J={key:g.q2(J,"videoPlaybackPositionEntity"),videoId:J,lastPlaybackPositionSeconds:"0"},U.push(MV(C,J,"videoPlaybackPositionEntity")),a.userState={playbackPosition:J.key},U.push(MV(C,
a,"mainVideoEntity")))}return g.u4.all(U)})}),0):b.return()})};
g.y.Mz=function(){var S,b,C,z,U,a,J,H,B,x,E,d,p,F,T,k,e,m,R,X,K,N,b2,I,$m,a8,S0,Y,q,P,r,QX,u6,d8,mR,b6,o5,FX;return g.O(function(G){if(G.J==1)return g.l(G,SF(),2);if(G.J!=3){S=G.K;if(!S)return G.return();b=g.q2("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.l(G,Ih(S,{mode:"readonly",He:!0},function(f){return g.u4.all([ni(f,b,"mainDownloadsListEntity"),ni(f,g.XO,"mainDownloadsListEntity"),gm(f,"mainVideoEntity"),gm(f,"mainPlaylistEntity")])}),3)}C=G.K;
z=g.t(C);U=z.next().value;a=z.next().value;J=z.next().value;H=z.next().value;B=U;x=a;E=J;d=H;p=new Set;if((F=B)==null?0:(T=F.downloads)==null?0:T.length)for(k=g.t(B.downloads),e=k.next();!e.done;e=k.next())m=e.value,R=void 0,(X=(R=m.videoItem)!=null?R:m.playlistItem)&&p.add(X);if((K=x)==null?0:(N=K.downloads)==null?0:N.length)for(b2=g.t(x.downloads),I=b2.next();!I.done;I=b2.next())$m=I.value,$m.videoItem&&p.add($m.videoItem);a8=new Set;S0=[];Y=g.t(d);for(q=Y.next();!q.done;q=Y.next()){P=q.value;if(P.videos)for(r=
g.t(P.videos),QX=r.next();!QX.done;QX=r.next())u6=QX.value,(d8=JSON.parse(g.Lh(u6).entityId).videoId)&&a8.add(d8);P.key&&!p.has(P.key)&&S0.push(P.key)}mR=g.t(E);for(b6=mR.next();!b6.done;b6=mR.next())o5=b6.value,o5.key&&!p.has(o5.key)&&(FX=g.Lh(o5.key).entityId,a8.has(FX)||S0.push(o5.key));return S0.length?g.l(G,HHK(S,S0),0):G.cS(0)})};g.V(lCO,jF);lCO.prototype.K=function(S){return HE(S)?X$L(this,S):BE(S)?OQ5(this,S):sL(S)?AkM(this,S):Promise.reject(Error("Unsupported action type: "+S.actionType))};
var wh=[10];g.V(KfM,jF);KfM.prototype.K=function(S){return HE(S)?ck2(this,S):BE(S)?DwO(this,S):sL(S)?NeL(this,S):Promise.reject(Error("Unsupported action type: "+S.actionType))};
var LY=[10];g.V(YBU,jF);YBU.prototype.K=function(S){return HE(S)?hv8(this,S):BE(S)?ICX(this,S):sL(S)?w$K(this,S):Promise.reject(Error("Unsupported action type: "+S.actionType))};
var ZQx=[10];g.V(qK,rh);qK.prototype.OF=function(S){var b=rh.prototype.OF.call(this,S);b.musicTrack=new YBU(S,this.J);b.musicPlaylist=new KfM(S,this.J);b.musicAlbumRelease=new lCO(S,this.J);return b};
qK.prototype.refreshAllStaleEntities=function(S,b){var C=this,z,U,a;return g.O(function(J){if(J.J==1)return g.l(J,qBm(C,S,b),2);if(J.J!=3)return U=z=J.K,a=U.concat,g.l(J,rh.prototype.refreshAllStaleEntities.call(C,S,b),3);z=a.call(U,J.K);return J.return(z)})};g.V(S45,g.E8);g.y=S45.prototype;g.y.create=function(){var S=this;g.n(this,this.events);g.SH(this.JB)?this.J=new mw8(this.JB,this.player):g.QG(this.JB)&&(this.J=new qK(this.JB,this.player));this.events.W(this.player,"onPlaybackStartExternal",function(){S.Ng()});
this.events.W(this.player,"videodatachange",function(){S.Ng()});
this.JB.L("html5_offline_playback_position_sync")&&this.events.W(this.player,"presentingplayerstatechange",this.vH)};
g.y.Qi=function(){return!1};
g.y.Pd=function(S,b,C,z){var U=this;return g.O(function(a){return U.J?a.return(Zh(U.J,S,b,C,z)):a.return(Promise.reject())})};
g.y.deleteAll=function(){return this.J.deleteAll()};
g.y.Pz=function(S){return this.J.Pz(S)};
g.y.refreshAllStaleEntities=function(S){return this.J.refreshAllStaleEntities(S)};
g.y.setUpPositionSyncInterval=function(S){this.J.setUpPositionSyncInterval(S)};
g.y.V$=function(S){this.J.V$(S)};
g.y.CA=function(S){return this.J.CA(S)};
g.y.Ng=function(){var S=this,b;return g.O(function(C){b=S.player.getVideoData();return g.wS(b)?bpM(b)&&S.K!==b.clientPlaybackNonce?g.l(C,CLU(S,b),0):C.cS(0):C.return()})};
g.y.vH=function(S){var b=this,C,z,U,a,J,H,B;return g.O(function(x){if(x.J==1)return C=b.player.getVideoData(),z=C.GE,g.d2(S,2)||g.d2(S,512)?g.l(x,SF(),2):x.return();if(x.J!=3){U=x.K;if(!U)return zl("PES is undefined"),x.return();a=C.videoId;return g.l(x,Li(U,g.q2(a,"mainVideoEntity"),"mainVideoEntity"),3)}J=x.K;if(!J)return x.return();H=Math.floor(z).toString();B={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:H}};return g.l(x,b.Pd([a],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
B),0)})};
g.y.isOrchestrationLeader=function(){return this.J.isOrchestrationLeader()};
g.y.updateDownloadState=function(S,b){var C,z,U,a;return g.O(function(J){if(J.J==1)return g.l(J,SF(),2);C=J.K;if(!C)return zl("PES is undefined"),J.return();z=g.Lh(S);U=z.entityType;a=z.entityId;return g.l(J,xf(a,U,C,b,!0),0)})};g.x4("offline",S45);})(_yt_player);
